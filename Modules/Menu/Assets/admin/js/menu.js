/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 9);
/******/ })
/************************************************************************/
/******/ ({

/***/ "./Modules/Menu/Resources/assets/admin/js/main.js":
/*!********************************************************!*\
  !*** ./Modules/Menu/Resources/assets/admin/js/main.js ***!
  \********************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var nestable2__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! nestable2 */ \"./node_modules/nestable2/jquery.nestable.js\");\n/* harmony import */ var nestable2__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(nestable2__WEBPACK_IMPORTED_MODULE_0__);\n\nwindow.admin.removeSubmitButtonOffsetOn('#image');\n$('#type').on('change', function (e) {\n  $('.link-field').addClass('hide');\n  $(\".\".concat(e.currentTarget.value, \"-field\")).removeClass('hide');\n});\n$('.dd').nestable({\n  maxDepth: 15\n});\n$('.dd').on('change', function () {\n  $.ajax({\n    type: 'PUT',\n    url: route('admin.menus.items.order.update'),\n    contentType: 'application/json; charset=utf-8',\n    data: JSON.stringify($('.dd').nestable('serialize')[0]),\n    success: function (_success) {\n      function success() {\n        return _success.apply(this, arguments);\n      }\n\n      success.toString = function () {\n        return _success.toString();\n      };\n\n      return success;\n    }(function () {\n      success(trans('menu::messages.menu_items_order_updated'));\n    }),\n    error: function (_error) {\n      function error(_x) {\n        return _error.apply(this, arguments);\n      }\n\n      error.toString = function () {\n        return _error.toString();\n      };\n\n      return error;\n    }(function (xhr) {\n      error(xhr.responseJSON.message);\n    })\n  });\n});\nvar id;\nvar confirmationModal = $('#confirmation-modal');\n$('.delete-menu-item').on('click', function (e) {\n  id = $(e.currentTarget).closest('.dd-item').data('id');\n  confirmationModal.modal('show');\n});\nconfirmationModal.find('form').on('submit', function (e) {\n  e.preventDefault();\n  confirmationModal.modal('hide');\n  $.ajax({\n    type: 'DELETE',\n    url: route('admin.menus.items.destroy', id),\n    success: function (_success2) {\n      function success() {\n        return _success2.apply(this, arguments);\n      }\n\n      success.toString = function () {\n        return _success2.toString();\n      };\n\n      return success;\n    }(function () {\n      success(trans('menu::messages.menu_item_deleted'));\n      $(\".dd-item[data-id=\\\"\".concat(id, \"\\\"]\")).fadeOut();\n    }),\n    error: function (_error2) {\n      function error(_x2) {\n        return _error2.apply(this, arguments);\n      }\n\n      error.toString = function () {\n        return _error2.toString();\n      };\n\n      return error;\n    }(function (xhr) {\n      error(xhr.responseJSON.message);\n    })\n  });\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9Nb2R1bGVzL01lbnUvUmVzb3VyY2VzL2Fzc2V0cy9hZG1pbi9qcy9tYWluLmpzPzIwYTQiXSwibmFtZXMiOlsid2luZG93IiwiYWRtaW4iLCJyZW1vdmVTdWJtaXRCdXR0b25PZmZzZXRPbiIsIiQiLCJvbiIsImUiLCJhZGRDbGFzcyIsImN1cnJlbnRUYXJnZXQiLCJ2YWx1ZSIsInJlbW92ZUNsYXNzIiwibmVzdGFibGUiLCJtYXhEZXB0aCIsImFqYXgiLCJ0eXBlIiwidXJsIiwicm91dGUiLCJjb250ZW50VHlwZSIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5Iiwic3VjY2VzcyIsInRyYW5zIiwiZXJyb3IiLCJ4aHIiLCJyZXNwb25zZUpTT04iLCJtZXNzYWdlIiwiaWQiLCJjb25maXJtYXRpb25Nb2RhbCIsImNsb3Nlc3QiLCJtb2RhbCIsImZpbmQiLCJwcmV2ZW50RGVmYXVsdCIsImZhZGVPdXQiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUFBLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhQywwQkFBYixDQUF3QyxRQUF4QztBQUVBQyxDQUFDLENBQUMsT0FBRCxDQUFELENBQVdDLEVBQVgsQ0FBYyxRQUFkLEVBQXdCLFVBQUNDLENBQUQsRUFBTztBQUMzQkYsR0FBQyxDQUFDLGFBQUQsQ0FBRCxDQUFpQkcsUUFBakIsQ0FBMEIsTUFBMUI7QUFDQUgsR0FBQyxZQUFLRSxDQUFDLENBQUNFLGFBQUYsQ0FBZ0JDLEtBQXJCLFlBQUQsQ0FBcUNDLFdBQXJDLENBQWlELE1BQWpEO0FBQ0gsQ0FIRDtBQUtBTixDQUFDLENBQUMsS0FBRCxDQUFELENBQVNPLFFBQVQsQ0FBa0I7QUFBRUMsVUFBUSxFQUFFO0FBQVosQ0FBbEI7QUFFQVIsQ0FBQyxDQUFDLEtBQUQsQ0FBRCxDQUFTQyxFQUFULENBQVksUUFBWixFQUFzQixZQUFNO0FBQ3hCRCxHQUFDLENBQUNTLElBQUYsQ0FBTztBQUNIQyxRQUFJLEVBQUUsS0FESDtBQUVIQyxPQUFHLEVBQUVDLEtBQUssQ0FBQyxnQ0FBRCxDQUZQO0FBR0hDLGVBQVcsRUFBRSxpQ0FIVjtBQUlIQyxRQUFJLEVBQUVDLElBQUksQ0FBQ0MsU0FBTCxDQUFlaEIsQ0FBQyxDQUFDLEtBQUQsQ0FBRCxDQUFTTyxRQUFULENBQWtCLFdBQWxCLEVBQStCLENBQS9CLENBQWYsQ0FKSDtBQUtIVSxXQUxHO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLGtCQUtPO0FBQ05BLGFBQU8sQ0FBQ0MsS0FBSyxDQUFDLHlDQUFELENBQU4sQ0FBUDtBQUNILEtBUEU7QUFRSEMsU0FSRztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSxnQkFRR0MsR0FSSCxFQVFRO0FBQ1BELFdBQUssQ0FBQ0MsR0FBRyxDQUFDQyxZQUFKLENBQWlCQyxPQUFsQixDQUFMO0FBQ0gsS0FWRTtBQUFBLEdBQVA7QUFZSCxDQWJEO0FBZUEsSUFBSUMsRUFBSjtBQUNBLElBQUlDLGlCQUFpQixHQUFHeEIsQ0FBQyxDQUFDLHFCQUFELENBQXpCO0FBRUFBLENBQUMsQ0FBQyxtQkFBRCxDQUFELENBQXVCQyxFQUF2QixDQUEwQixPQUExQixFQUFtQyxVQUFDQyxDQUFELEVBQU87QUFDdENxQixJQUFFLEdBQUd2QixDQUFDLENBQUNFLENBQUMsQ0FBQ0UsYUFBSCxDQUFELENBQW1CcUIsT0FBbkIsQ0FBMkIsVUFBM0IsRUFBdUNYLElBQXZDLENBQTRDLElBQTVDLENBQUw7QUFFQVUsbUJBQWlCLENBQUNFLEtBQWxCLENBQXdCLE1BQXhCO0FBQ0gsQ0FKRDtBQU1BRixpQkFBaUIsQ0FBQ0csSUFBbEIsQ0FBdUIsTUFBdkIsRUFBK0IxQixFQUEvQixDQUFrQyxRQUFsQyxFQUE0QyxVQUFDQyxDQUFELEVBQU87QUFDL0NBLEdBQUMsQ0FBQzBCLGNBQUY7QUFFQUosbUJBQWlCLENBQUNFLEtBQWxCLENBQXdCLE1BQXhCO0FBRUExQixHQUFDLENBQUNTLElBQUYsQ0FBTztBQUNIQyxRQUFJLEVBQUUsUUFESDtBQUVIQyxPQUFHLEVBQUVDLEtBQUssQ0FBQywyQkFBRCxFQUE4QlcsRUFBOUIsQ0FGUDtBQUdITixXQUhHO0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLGtCQUdPO0FBQ05BLGFBQU8sQ0FBQ0MsS0FBSyxDQUFDLGtDQUFELENBQU4sQ0FBUDtBQUVBbEIsT0FBQyw4QkFBc0J1QixFQUF0QixTQUFELENBQStCTSxPQUEvQjtBQUNILEtBUEU7QUFRSFYsU0FSRztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSxnQkFRR0MsR0FSSCxFQVFRO0FBQ1BELFdBQUssQ0FBQ0MsR0FBRyxDQUFDQyxZQUFKLENBQWlCQyxPQUFsQixDQUFMO0FBQ0gsS0FWRTtBQUFBLEdBQVA7QUFZSCxDQWpCRCIsImZpbGUiOiIuL01vZHVsZXMvTWVudS9SZXNvdXJjZXMvYXNzZXRzL2FkbWluL2pzL21haW4uanMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ25lc3RhYmxlMic7XG5cbndpbmRvdy5hZG1pbi5yZW1vdmVTdWJtaXRCdXR0b25PZmZzZXRPbignI2ltYWdlJyk7XG5cbiQoJyN0eXBlJykub24oJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgJCgnLmxpbmstZmllbGQnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICQoYC4ke2UuY3VycmVudFRhcmdldC52YWx1ZX0tZmllbGRgKS5yZW1vdmVDbGFzcygnaGlkZScpO1xufSk7XG5cbiQoJy5kZCcpLm5lc3RhYmxlKHsgbWF4RGVwdGg6IDE1IH0pO1xuXG4kKCcuZGQnKS5vbignY2hhbmdlJywgKCkgPT4ge1xuICAgICQuYWpheCh7XG4gICAgICAgIHR5cGU6ICdQVVQnLFxuICAgICAgICB1cmw6IHJvdXRlKCdhZG1pbi5tZW51cy5pdGVtcy5vcmRlci51cGRhdGUnKSxcbiAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04JyxcbiAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoJCgnLmRkJykubmVzdGFibGUoJ3NlcmlhbGl6ZScpWzBdKSxcbiAgICAgICAgc3VjY2VzcygpIHtcbiAgICAgICAgICAgIHN1Y2Nlc3ModHJhbnMoJ21lbnU6Om1lc3NhZ2VzLm1lbnVfaXRlbXNfb3JkZXJfdXBkYXRlZCcpKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IoeGhyKSB7XG4gICAgICAgICAgICBlcnJvcih4aHIucmVzcG9uc2VKU09OLm1lc3NhZ2UpO1xuICAgICAgICB9LFxuICAgIH0pO1xufSk7XG5cbmxldCBpZDtcbmxldCBjb25maXJtYXRpb25Nb2RhbCA9ICQoJyNjb25maXJtYXRpb24tbW9kYWwnKTtcblxuJCgnLmRlbGV0ZS1tZW51LWl0ZW0nKS5vbignY2xpY2snLCAoZSkgPT4ge1xuICAgIGlkID0gJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoJy5kZC1pdGVtJykuZGF0YSgnaWQnKTtcblxuICAgIGNvbmZpcm1hdGlvbk1vZGFsLm1vZGFsKCdzaG93Jyk7XG59KTtcblxuY29uZmlybWF0aW9uTW9kYWwuZmluZCgnZm9ybScpLm9uKCdzdWJtaXQnLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGNvbmZpcm1hdGlvbk1vZGFsLm1vZGFsKCdoaWRlJyk7XG5cbiAgICAkLmFqYXgoe1xuICAgICAgICB0eXBlOiAnREVMRVRFJyxcbiAgICAgICAgdXJsOiByb3V0ZSgnYWRtaW4ubWVudXMuaXRlbXMuZGVzdHJveScsIGlkKSxcbiAgICAgICAgc3VjY2VzcygpIHtcbiAgICAgICAgICAgIHN1Y2Nlc3ModHJhbnMoJ21lbnU6Om1lc3NhZ2VzLm1lbnVfaXRlbV9kZWxldGVkJykpO1xuXG4gICAgICAgICAgICAkKGAuZGQtaXRlbVtkYXRhLWlkPVwiJHtpZH1cIl1gKS5mYWRlT3V0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yKHhocikge1xuICAgICAgICAgICAgZXJyb3IoeGhyLnJlc3BvbnNlSlNPTi5tZXNzYWdlKTtcbiAgICAgICAgfSxcbiAgICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./Modules/Menu/Resources/assets/admin/js/main.js\n");

/***/ }),

/***/ "./node_modules/nestable2/jquery.nestable.js":
/*!***************************************************!*\
  !*** ./node_modules/nestable2/jquery.nestable.js ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/*!\n * Nestable jQuery Plugin - Copyright (c) 2014 Ramon Smit - https://github.com/RamonSmit/Nestable\n */\n\n(function($, window, document, undefined) {\n    var hasTouch = 'ontouchstart' in document;\n\n    /**\n     * Detect CSS pointer-events property\n     * events are normally disabled on the dragging element to avoid conflicts\n     * https://github.com/ausi/Feature-detection-technique-for-pointer-events/blob/master/modernizr-pointerevents.js\n     */\n    var hasPointerEvents = (function() {\n        var el = document.createElement('div'),\n            docEl = document.documentElement;\n        if (!('pointerEvents' in el.style)) {\n            return false;\n        }\n        el.style.pointerEvents = 'auto';\n        el.style.pointerEvents = 'x';\n        docEl.appendChild(el);\n        var supports = window.getComputedStyle && window.getComputedStyle(el, '').pointerEvents === 'auto';\n        docEl.removeChild(el);\n        return !!supports;\n    })();\n\n    var defaults = {\n        contentCallback: function(item) {return item.content || '' ? item.content : item.id;},\n        listNodeName: 'ol',\n        itemNodeName: 'li',\n        handleNodeName: 'div',\n        contentNodeName: 'span',\n        rootClass: 'dd',\n        listClass: 'dd-list',\n        itemClass: 'dd-item',\n        dragClass: 'dd-dragel',\n        handleClass: 'dd-handle',\n        contentClass: 'dd-content',\n        collapsedClass: 'dd-collapsed',\n        placeClass: 'dd-placeholder',\n        noDragClass: 'dd-nodrag',\n        noChildrenClass: 'dd-nochildren',\n        emptyClass: 'dd-empty',\n        expandBtnHTML: '<button class=\"dd-expand\" data-action=\"expand\" type=\"button\">Expand</button>',\n        collapseBtnHTML: '<button class=\"dd-collapse\" data-action=\"collapse\" type=\"button\">Collapse</button>',\n        group: 0,\n        maxDepth: 5,\n        threshold: 20,\n        fixedDepth: false, //fixed item's depth\n        fixed: false,\n        includeContent: false,\n        scroll: false,\n        scrollSensitivity: 1,\n        scrollSpeed: 5,\n        scrollTriggers: {\n            top: 40,\n            left: 40,\n            right: -40,\n            bottom: -40\n        },\n        effect: {\n            animation: 'none',\n            time: 'slow'\n        },\n        callback: function(l, e, p) {},\n        onDragStart: function(l, e, p) {},\n        beforeDragStop: function(l, e, p) {},\n        listRenderer: function(children, options) {\n            var html = '<' + options.listNodeName + ' class=\"' + options.listClass + '\">';\n            html += children;\n            html += '</' + options.listNodeName + '>';\n\n            return html;\n        },\n        itemRenderer: function(item_attrs, content, children, options, item) {\n            var item_attrs_string = $.map(item_attrs, function(value, key) {\n                return ' ' + key + '=\"' + value + '\"';\n            }).join(' ');\n\n            var html = '<' + options.itemNodeName + item_attrs_string + '>';\n            html += '<' + options.handleNodeName + ' class=\"' + options.handleClass + '\">';\n            html += '<' + options.contentNodeName + ' class=\"' + options.contentClass + '\">';\n            html += content;\n            html += '</' + options.contentNodeName + '>';\n            html += '</' + options.handleNodeName + '>';\n            html += children;\n            html += '</' + options.itemNodeName + '>';\n\n            return html;\n        }\n    };\n\n    function Plugin(element, options) {\n        this.w  = $(document);\n        this.el = $(element);\n        options = options || defaults;\n\n        if (options.rootClass !== undefined && options.rootClass !== 'dd') {\n            options.listClass       = options.listClass ? options.listClass : options.rootClass + '-list';\n            options.itemClass       = options.itemClass ? options.itemClass : options.rootClass + '-item';\n            options.dragClass       = options.dragClass ? options.dragClass : options.rootClass + '-dragel';\n            options.handleClass     = options.handleClass ? options.handleClass : options.rootClass + '-handle';\n            options.collapsedClass  = options.collapsedClass ? options.collapsedClass : options.rootClass + '-collapsed';\n            options.placeClass      = options.placeClass ? options.placeClass : options.rootClass + '-placeholder';\n            options.noDragClass     = options.noDragClass ? options.noDragClass : options.rootClass + '-nodrag';\n            options.noChildrenClass = options.noChildrenClass ? options.noChildrenClass : options.rootClass + '-nochildren';\n            options.emptyClass      = options.emptyClass ? options.emptyClass : options.rootClass + '-empty';\n        }\n\n        this.options = $.extend({}, defaults, options);\n\n        // build HTML from serialized JSON if passed\n        if (this.options.json !== undefined) {\n            this._build();\n        }\n\n        this.init();\n    }\n\n    Plugin.prototype = {\n\n        init: function() {\n            var list = this;\n\n            list.reset();\n            list.el.data('nestable-group', this.options.group);\n            list.placeEl = $('<div class=\"' + list.options.placeClass + '\"/>');\n\n            var items = this.el.find(list.options.itemNodeName);\n            $.each(items, function(k, el) {\n                var item = $(el),\n                    parent = item.parent();\n                list.setParent(item);\n                if (parent.hasClass(list.options.collapsedClass)) {\n                    list.collapseItem(parent.parent());\n                }\n            });\n\n            // Append the .dd-empty div if the list don't have any items on init\n            if (!items.length) {\n                this.appendEmptyElement(this.el);\n            }\n\n            list.el.on('click', 'button', function(e) {\n                if (list.dragEl) {\n                    return;\n                }\n                var target = $(e.currentTarget),\n                    action = target.data('action'),\n                    item = target.parents(list.options.itemNodeName).eq(0);\n                if (action === 'collapse') {\n                    list.collapseItem(item);\n                }\n                if (action === 'expand') {\n                    list.expandItem(item);\n                }\n            });\n\n            var onStartEvent = function(e) {\n                var handle = $(e.target);\n                if (!handle.hasClass(list.options.handleClass)) {\n                    if (handle.closest('.' + list.options.noDragClass).length) {\n                        return;\n                    }\n                    handle = handle.closest('.' + list.options.handleClass);\n                }\n                if (!handle.length || list.dragEl) {\n                    return;\n                }\n\n                list.isTouch = /^touch/.test(e.type);\n                if (list.isTouch && e.touches.length !== 1) {\n                    return;\n                }\n\n                e.preventDefault();\n                list.dragStart(e.touches ? e.touches[0] : e);\n            };\n\n            var onMoveEvent = function(e) {\n                if (list.dragEl) {\n                    e.preventDefault();\n                    list.dragMove(e.touches ? e.touches[0] : e);\n                }\n            };\n\n            var onEndEvent = function(e) {\n                if (list.dragEl) {\n                    e.preventDefault();\n                    list.dragStop(e.touches ? e.changedTouches[0] : e);\n                }\n            };\n\n            if (hasTouch) {\n                list.el[0].addEventListener('touchstart', onStartEvent, false);\n                window.addEventListener('touchmove', onMoveEvent, false);\n                window.addEventListener('touchend', onEndEvent, false);\n                window.addEventListener('touchcancel', onEndEvent, false);\n            }\n\n            list.el.on('mousedown', onStartEvent);\n            list.w.on('mousemove', onMoveEvent);\n            list.w.on('mouseup', onEndEvent);\n\n            var destroyNestable = function()\n            {\n                if (hasTouch) {\n                    list.el[0].removeEventListener('touchstart', onStartEvent, false);\n                    window.removeEventListener('touchmove', onMoveEvent, false);\n                    window.removeEventListener('touchend', onEndEvent, false);\n                    window.removeEventListener('touchcancel', onEndEvent, false);\n                }\n\n                list.el.off('mousedown', onStartEvent);\n                list.w.off('mousemove', onMoveEvent);\n                list.w.off('mouseup', onEndEvent);\n\n                list.el.off('click');\n                list.el.unbind('destroy-nestable');\n\n                list.el.data(\"nestable\", null);\n            };\n\n            list.el.bind('destroy-nestable', destroyNestable);\n\n        },\n\n        destroy: function ()\n        {\n            this.el.trigger('destroy-nestable');\n        },\n\n        add: function (item)\n        {\n            var listClassSelector = '.' + this.options.listClass;\n            var tree = $(this.el).children(listClassSelector);\n\n            if (item.parent_id !== undefined) {\n                tree = tree.find('[data-id=\"' + item.parent_id + '\"]');\n                delete item.parent_id;\n\n                if (tree.children(listClassSelector).length === 0) {\n                    tree = tree.append(this.options.listRenderer('', this.options));\n                }\n\n                tree = tree.find(listClassSelector + ':first');\n                this.setParent(tree.parent());\n            }\n\n            tree.append(this._buildItem(item, this.options));\n        },\n\n        replace: function (item)\n        {\n            var html = this._buildItem(item, this.options);\n\n            this._getItemById(item.id)\n                .replaceWith(html);\n        },\n\n        //removes item and additional elements from list\n        removeItem: function (item){\n            var opts = this.options,\n                el   = this.el;\n\n            // remove item\n            item = item || this;\n            item.remove();\n\n            // remove empty children lists\n            var emptyListsSelector = '.' + opts.listClass\n                + ' .' + opts.listClass + ':not(:has(*))';\n            $(el).find(emptyListsSelector).remove();\n\n            // remove buttons if parents do not have children\n            var buttonsSelector = '[data-action=\"expand\"], [data-action=\"collapse\"]';\n            $(el).find(buttonsSelector).each(function() {\n                var siblings = $(this).siblings('.' + opts.listClass);\n                if (siblings.length === 0) {\n                    $(this).remove();\n                }\n            });\n        },\n\n        //removes item by itemId and run callback at the end\n        remove: function (itemId, callback)\n        {\n            var opts = this.options;\n            var list = this;\n            var item = this._getItemById(itemId);\n\n            //animation style\n            var animation = opts.effect.animation || 'fade';\n\n            //animation time\n            var time = opts.effect.time || 'slow';\n\n            //add fadeOut effect when removing\n            if (animation === 'fade'){\n                item.fadeOut(time, function(){\n                    list.removeItem(item);\n                });\n            }\n            else {\n                this.removeItem(item);\n            }\n\n            if (callback) callback();\n        },\n\n        //removes all items from the list and run callback at the end\n        removeAll: function(callback){\n\n            var list  = this,\n                opts  = this.options,\n                node  = list.el.find(opts.listNodeName).first(),\n                items = node.children(opts.itemNodeName);\n\n            //animation style\n            var animation = opts.effect.animation || 'fade';\n\n            //animation time\n            var time = opts.effect.time || 'slow';\n\n            function remove(){\n                //Removes each item and its children.\n                items.each(function() {\n                    list.removeItem($(this));\n                });\n                //Now we can again show our node element\n                node.show();\n                if (callback) callback();\n            }\n\n            //add fadeOut effect when removing\n            if (animation === 'fade'){\n                node.fadeOut(time, remove);\n            }\n            else {\n                remove();\n            }\n        },\n\n        _getItemById: function(itemId) {\n            return $(this.el).children('.' + this.options.listClass)\n                .find('[data-id=\"' + itemId + '\"]');\n        },\n\n        _build: function() {\n            var json = this.options.json;\n\n            if (typeof json === 'string') {\n                json = JSON.parse(json);\n            }\n\n            $(this.el).html(this._buildList(json, this.options));\n        },\n\n        _buildList: function(items, options) {\n            if (!items) {\n                return '';\n            }\n\n            var children = '';\n            var that = this;\n\n            $.each(items, function(index, sub) {\n                children += that._buildItem(sub, options);\n            });\n\n            return options.listRenderer(children, options);\n        },\n\n        _buildItem: function(item, options) {\n            function escapeHtml(text) {\n                var map = {\n                    '&': '&amp;',\n                    '<': '&lt;',\n                    '>': '&gt;',\n                    '\"': '&quot;',\n                    \"'\": '&#039;'\n                };\n\n                return text + \"\".replace(/[&<>\"']/g, function(m) { return map[m]; });\n            }\n\n            function filterClasses(classes) {\n                var new_classes = {};\n\n                for (var k in classes) {\n                    // Remove duplicates\n                    new_classes[classes[k]] = classes[k];\n                }\n\n                return new_classes;\n            }\n\n            function createClassesString(item, options) {\n                var classes = item.classes || {};\n\n                if (typeof classes === 'string') {\n                    classes = [classes];\n                }\n\n                var item_classes = filterClasses(classes);\n                item_classes[options.itemClass] = options.itemClass;\n\n                // create class string\n                return $.map(item_classes, function(val) {\n                    return val;\n                }).join(' ');\n            }\n\n            function createDataAttrs(attr) {\n                attr = $.extend({}, attr);\n\n                delete attr.children;\n                delete attr.classes;\n                delete attr.content;\n\n                var data_attrs = {};\n\n                $.each(attr, function(key, value) {\n                    if (typeof value === 'object') {\n                        value = JSON.stringify(value);\n                    }\n\n                    data_attrs[\"data-\" + key] = escapeHtml(value);\n                });\n\n                return data_attrs;\n            }\n\n            var item_attrs = createDataAttrs(item);\n            item_attrs[\"class\"] = createClassesString(item, options);\n\n            var content = options.contentCallback(item);\n            var children = this._buildList(item.children, options);\n            var html = $(options.itemRenderer(item_attrs, content, children, options, item));\n\n            this.setParent(html);\n\n            return html[0].outerHTML;\n        },\n\n        serialize: function() {\n            var data, list = this, step = function(level) {\n                var array = [],\n                    items = level.children(list.options.itemNodeName);\n                items.each(function() {\n                    var li = $(this),\n                        item = $.extend({}, li.data()),\n                        sub = li.children(list.options.listNodeName);\n\n                    if (list.options.includeContent) {\n                        var content = li.find('.' + list.options.contentClass).html();\n\n                        if (content) {\n                            item.content = content;\n                        }\n                    }\n\n                    if (sub.length) {\n                        item.children = step(sub);\n                    }\n                    array.push(item);\n                });\n                return array;\n            };\n            data = step(list.el.find(list.options.listNodeName).first());\n            return data;\n        },\n\n        asNestedSet: function() {\n            var list = this, o = list.options, depth = -1, ret = [], lft = 1;\n            var items = list.el.find(o.listNodeName).first().children(o.itemNodeName);\n\n            items.each(function () {\n                lft = traverse(this, depth + 1, lft);\n            });\n\n            ret = ret.sort(function(a,b){ return (a.lft - b.lft); });\n            return ret;\n\n            function traverse(item, depth, lft) {\n                var rgt = lft + 1, id, pid;\n\n                if ($(item).children(o.listNodeName).children(o.itemNodeName).length > 0 ) {\n                    depth++;\n                    $(item).children(o.listNodeName).children(o.itemNodeName).each(function () {\n                        rgt = traverse($(this), depth, rgt);\n                    });\n                    depth--;\n                }\n\n                id = $(item).attr('data-id');\n                if (isInt(id)) {\n                    id = parseInt(id);\n                }\n\n                pid = $(item).parent(o.listNodeName).parent(o.itemNodeName).attr('data-id') || '';\n                if (isInt(pid)) {\n                    id = parseInt(pid);\n                }\n\n                if (id) {\n                    ret.push({\"id\": id, \"parent_id\": pid, \"depth\": depth, \"lft\": lft, \"rgt\": rgt});\n                }\n\n                lft = rgt + 1;\n                return lft;\n            }\n\n            function isInt(value) {\n                return $.isNumeric(value) && Math.floor(value) == value;\n            }\n        },\n\n        returnOptions: function() {\n            return this.options;\n        },\n\n        serialise: function() {\n            return this.serialize();\n        },\n\n        toHierarchy: function(options) {\n\n            var o = $.extend({}, this.options, options),\n                ret = [];\n\n            $(this.element).children(o.items).each(function() {\n                var level = _recursiveItems(this);\n                ret.push(level);\n            });\n\n            return ret;\n\n            function _recursiveItems(item) {\n                var id = ($(item).attr(o.attribute || 'id') || '').match(o.expression || (/(.+)[-=_](.+)/));\n                if (id) {\n                    var currentItem = {\n                        \"id\": id[2]\n                    };\n                    if ($(item).children(o.listType).children(o.items).length > 0) {\n                        currentItem.children = [];\n                        $(item).children(o.listType).children(o.items).each(function() {\n                            var level = _recursiveItems(this);\n                            currentItem.children.push(level);\n                        });\n                    }\n                    return currentItem;\n                }\n            }\n        },\n\n        toArray: function() {\n\n            var o = $.extend({}, this.options, this),\n                sDepth = o.startDepthCount || 0,\n                ret = [],\n                left = 2,\n                list = this,\n                element = list.el.find(list.options.listNodeName).first();\n\n            var items = element.children(list.options.itemNodeName);\n            items.each(function() {\n                left = _recursiveArray($(this), sDepth + 1, left);\n            });\n\n            ret = ret.sort(function(a, b) {\n                return (a.left - b.left);\n            });\n\n            return ret;\n\n            function _recursiveArray(item, depth, left) {\n\n                var right = left + 1,\n                    id,\n                    pid;\n\n                if (item.children(o.options.listNodeName).children(o.options.itemNodeName).length > 0) {\n                    depth++;\n                    item.children(o.options.listNodeName).children(o.options.itemNodeName).each(function() {\n                        right = _recursiveArray($(this), depth, right);\n                    });\n                    depth--;\n                }\n\n                id = item.data().id;\n\n\n                if (depth === sDepth + 1) {\n                    pid = o.rootID;\n                } else {\n\n                    var parentItem = (item.parent(o.options.listNodeName)\n                        .parent(o.options.itemNodeName)\n                        .data());\n                    pid = parentItem.id;\n\n                }\n\n                if (id) {\n                    ret.push({\n                        \"id\": id,\n                        \"parent_id\": pid,\n                        \"depth\": depth,\n                        \"left\": left,\n                        \"right\": right\n                    });\n                }\n\n                left = right + 1;\n                return left;\n            }\n\n        },\n\n        reset: function() {\n            this.mouse = {\n                offsetX: 0,\n                offsetY: 0,\n                startX: 0,\n                startY: 0,\n                lastX: 0,\n                lastY: 0,\n                nowX: 0,\n                nowY: 0,\n                distX: 0,\n                distY: 0,\n                dirAx: 0,\n                dirX: 0,\n                dirY: 0,\n                lastDirX: 0,\n                lastDirY: 0,\n                distAxX: 0,\n                distAxY: 0\n            };\n            this.isTouch = false;\n            this.moving = false;\n            this.dragEl = null;\n            this.dragRootEl = null;\n            this.dragDepth = 0;\n            this.hasNewRoot = false;\n            this.pointEl = null;\n        },\n\n        expandItem: function(li) {\n            li.removeClass(this.options.collapsedClass);\n        },\n\n        collapseItem: function(li) {\n            var lists = li.children(this.options.listNodeName);\n            if (lists.length) {\n                li.addClass(this.options.collapsedClass);\n            }\n        },\n\n        expandAll: function() {\n            var list = this;\n            list.el.find(list.options.itemNodeName).each(function() {\n                list.expandItem($(this));\n            });\n        },\n\n        collapseAll: function() {\n            var list = this;\n            list.el.find(list.options.itemNodeName).each(function() {\n                list.collapseItem($(this));\n            });\n        },\n\n        setParent: function(li) {\n            //Check if li is an element of itemNodeName type and has children\n            if (li.is(this.options.itemNodeName) && li.children(this.options.listNodeName).length) {\n                // make sure NOT showing two or more sets data-action buttons\n                li.children('[data-action]').remove();\n                li.prepend($(this.options.expandBtnHTML));\n                li.prepend($(this.options.collapseBtnHTML));\n            }\n        },\n\n        unsetParent: function(li) {\n            li.removeClass(this.options.collapsedClass);\n            li.children('[data-action]').remove();\n            li.children(this.options.listNodeName).remove();\n        },\n\n        dragStart: function(e) {\n            var mouse = this.mouse,\n                target = $(e.target),\n                dragItem = target.closest(this.options.itemNodeName),\n                position = {\n                    top  : e.pageY,\n                    left : e.pageX\n                };\n\n            var continueExecution = this.options.onDragStart.call(this, this.el, dragItem, position);\n\n            if (typeof continueExecution !== 'undefined' && continueExecution === false) {\n                return;\n            }\n\n            this.placeEl.css('height', dragItem.height());\n\n            mouse.offsetX = e.pageX - dragItem.offset().left;\n            mouse.offsetY = e.pageY - dragItem.offset().top;\n            mouse.startX = mouse.lastX = e.pageX;\n            mouse.startY = mouse.lastY = e.pageY;\n\n            this.dragRootEl = this.el;\n            this.dragEl = $(document.createElement(this.options.listNodeName)).addClass(this.options.listClass + ' ' + this.options.dragClass);\n            this.dragEl.css('width', dragItem.outerWidth());\n\n            this.setIndexOfItem(dragItem);\n\n            // fix for zepto.js\n            //dragItem.after(this.placeEl).detach().appendTo(this.dragEl);\n            dragItem.after(this.placeEl);\n            dragItem[0].parentNode.removeChild(dragItem[0]);\n            dragItem.appendTo(this.dragEl);\n\n            $(document.body).append(this.dragEl);\n            this.dragEl.css({\n                'left': e.pageX - mouse.offsetX,\n                'top': e.pageY - mouse.offsetY\n            });\n            // total depth of dragging item\n            var i, depth,\n                items = this.dragEl.find(this.options.itemNodeName);\n            for (i = 0; i < items.length; i++) {\n                depth = $(items[i]).parents(this.options.listNodeName).length;\n                if (depth > this.dragDepth) {\n                    this.dragDepth = depth;\n                }\n            }\n        },\n\n        //Create sublevel.\n        //  element : element which become parent\n        //  item    : something to place into new sublevel\n        createSubLevel: function(element, item) {\n            var list = $('<' + this.options.listNodeName + '/>').addClass(this.options.listClass);\n            if (item) list.append(item);\n            element.append(list);\n            this.setParent(element);\n            return list;\n        },\n\n        setIndexOfItem: function(item, index) {\n            index = index || [];\n\n            index.unshift(item.index());\n\n            if ($(item[0].parentNode)[0] !== this.dragRootEl[0]) {\n                this.setIndexOfItem($(item[0].parentNode), index);\n            }\n            else {\n                this.dragEl.data('indexOfItem', index);\n            }\n        },\n\n        restoreItemAtIndex: function(dragElement, indexArray) {\n            var currentEl = this.el,\n                lastIndex = indexArray.length - 1;\n\n            //Put drag element at current element position.\n            function placeElement(currentEl, dragElement) {\n                if (indexArray[lastIndex] === 0) {\n                    $(currentEl).prepend(dragElement.clone(true)); //using true saves added to element events.\n                }\n                else {\n                    $(currentEl.children[indexArray[lastIndex] - 1]).after(dragElement.clone(true)); //using true saves added to element events.\n                }\n            }\n            //Diggin through indexArray to get home for dragElement.\n            for (var i = 0; i < indexArray.length; i++) {\n                if (lastIndex === parseInt(i)) {\n                    placeElement(currentEl, dragElement);\n                    return;\n                }\n                //element can have no indexes, so we have to use conditional here to avoid errors.\n                //if element doesn't exist we defenetly need to add new list.\n                var element = (currentEl[0]) ? currentEl[0] : currentEl;\n                var nextEl  = element.children[indexArray[i]];\n                currentEl   = (!nextEl) ? this.createSubLevel($(element)) : nextEl;\n            }\n        },\n\n        dragStop: function(e) {\n            // fix for zepto.js\n            //this.placeEl.replaceWith(this.dragEl.children(this.options.itemNodeName + ':first').detach());\n            var position = {\n                top  : e.pageY,\n                left : e.pageX\n            };\n            //Get indexArray of item at drag start.\n            var srcIndex = this.dragEl.data('indexOfItem');\n\n            var el = this.dragEl.children(this.options.itemNodeName).first();\n\n            el[0].parentNode.removeChild(el[0]);\n\n            this.dragEl.remove(); //Remove dragEl, cause it can affect on indexing in html collection.\n\n            //Before drag stop callback\n            var continueExecution = this.options.beforeDragStop.call(this, this.el, el, this.placeEl.parent());\n            if (typeof continueExecution !== 'undefined' && continueExecution === false) {\n                var parent = this.placeEl.parent();\n                this.placeEl.remove();\n                if (!parent.children().length) {\n                    this.unsetParent(parent.parent());\n                }\n                this.restoreItemAtIndex(el, srcIndex);\n                this.reset();\n                return;\n            }\n\n            this.placeEl.replaceWith(el);\n\n            if (this.hasNewRoot) {\n                if (this.options.fixed === true) {\n                    this.restoreItemAtIndex(el, srcIndex);\n                }\n                else {\n                    this.el.trigger('lostItem');\n                }\n                this.dragRootEl.trigger('gainedItem');\n            }\n            else {\n                this.dragRootEl.trigger('change');\n            }\n\n            this.options.callback.call(this, this.dragRootEl, el, position);\n\n            this.reset();\n        },\n\n        dragMove: function(e) {\n            var list, parent, prev, next, depth,\n                opt = this.options,\n                mouse = this.mouse;\n\n            this.dragEl.css({\n                'left': e.pageX - mouse.offsetX,\n                'top': e.pageY - mouse.offsetY\n            });\n\n            // mouse position last events\n            mouse.lastX = mouse.nowX;\n            mouse.lastY = mouse.nowY;\n            // mouse position this events\n            mouse.nowX = e.pageX;\n            mouse.nowY = e.pageY;\n            // distance mouse moved between events\n            mouse.distX = mouse.nowX - mouse.lastX;\n            mouse.distY = mouse.nowY - mouse.lastY;\n            // direction mouse was moving\n            mouse.lastDirX = mouse.dirX;\n            mouse.lastDirY = mouse.dirY;\n            // direction mouse is now moving (on both axis)\n            mouse.dirX = mouse.distX === 0 ? 0 : mouse.distX > 0 ? 1 : -1;\n            mouse.dirY = mouse.distY === 0 ? 0 : mouse.distY > 0 ? 1 : -1;\n            // axis mouse is now moving on\n            var newAx = Math.abs(mouse.distX) > Math.abs(mouse.distY) ? 1 : 0;\n\n            // do nothing on first move\n            if (!mouse.moving) {\n                mouse.dirAx = newAx;\n                mouse.moving = true;\n                return;\n            }\n\n            // do scrolling if enable\n            if (opt.scroll) {\n                if (typeof window.jQuery.fn.scrollParent !== 'undefined') {\n                    var scrolled = false;\n                    var scrollParent = this.el.scrollParent()[0];\n                    if (scrollParent !== document && scrollParent.tagName !== 'HTML') {\n                        if ((opt.scrollTriggers.bottom + scrollParent.offsetHeight) - e.pageY < opt.scrollSensitivity)\n                            scrollParent.scrollTop = scrolled = scrollParent.scrollTop + opt.scrollSpeed;\n                        else if (e.pageY - opt.scrollTriggers.top < opt.scrollSensitivity)\n                            scrollParent.scrollTop = scrolled = scrollParent.scrollTop - opt.scrollSpeed;\n\n                        if ((opt.scrollTriggers.right + scrollParent.offsetWidth) - e.pageX < opt.scrollSensitivity)\n                            scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft + opt.scrollSpeed;\n                        else if (e.pageX - opt.scrollTriggers.left < opt.scrollSensitivity)\n                            scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft - opt.scrollSpeed;\n                    } else {\n                        if (e.pageY - $(document).scrollTop() < opt.scrollSensitivity)\n                            scrolled = $(document).scrollTop($(document).scrollTop() - opt.scrollSpeed);\n                        else if ($(window).height() - (e.pageY - $(document).scrollTop()) < opt.scrollSensitivity)\n                            scrolled = $(document).scrollTop($(document).scrollTop() + opt.scrollSpeed);\n\n                        if (e.pageX - $(document).scrollLeft() < opt.scrollSensitivity)\n                            scrolled = $(document).scrollLeft($(document).scrollLeft() - opt.scrollSpeed);\n                        else if ($(window).width() - (e.pageX - $(document).scrollLeft()) < opt.scrollSensitivity)\n                            scrolled = $(document).scrollLeft($(document).scrollLeft() + opt.scrollSpeed);\n                    }\n                } else {\n                    console.warn('To use scrolling you need to have scrollParent() function, check documentation for more information');\n                }\n            }\n\n            if (this.scrollTimer) {\n                clearTimeout(this.scrollTimer);\n            }\n\n            if (opt.scroll && scrolled) {\n                this.scrollTimer = setTimeout(function() {\n                    $(window).trigger(e);\n                }, 10);\n            }\n\n            // calc distance moved on this axis (and direction)\n            if (mouse.dirAx !== newAx) {\n                mouse.distAxX = 0;\n                mouse.distAxY = 0;\n            }\n            else {\n                mouse.distAxX += Math.abs(mouse.distX);\n                if (mouse.dirX !== 0 && mouse.dirX !== mouse.lastDirX) {\n                    mouse.distAxX = 0;\n                }\n                mouse.distAxY += Math.abs(mouse.distY);\n                if (mouse.dirY !== 0 && mouse.dirY !== mouse.lastDirY) {\n                    mouse.distAxY = 0;\n                }\n            }\n            mouse.dirAx = newAx;\n\n            /**\n             * move horizontal\n             */\n            if (mouse.dirAx && mouse.distAxX >= opt.threshold) {\n                // reset move distance on x-axis for new phase\n                mouse.distAxX = 0;\n                prev = this.placeEl.prev(opt.itemNodeName);\n                // increase horizontal level if previous sibling exists, is not collapsed, and can have children\n                if (mouse.distX > 0 && prev.length && !prev.hasClass(opt.collapsedClass) && !prev.hasClass(opt.noChildrenClass)) {\n                    // cannot increase level when item above is collapsed\n                    list = prev.find(opt.listNodeName).last();\n                    // check if depth limit has reached\n                    depth = this.placeEl.parents(opt.listNodeName).length;\n                    if (depth + this.dragDepth <= opt.maxDepth) {\n                        // create new sub-level if one doesn't exist\n                        if (!list.length) {\n                            this.createSubLevel(prev, this.placeEl);\n                        }\n                        else {\n                            // else append to next level up\n                            list = prev.children(opt.listNodeName).last();\n                            list.append(this.placeEl);\n                        }\n                    }\n                }\n                // decrease horizontal level\n                if (mouse.distX < 0) {\n                    // we can't decrease a level if an item preceeds the current one\n                    next = this.placeEl.next(opt.itemNodeName);\n                    if (!next.length) {\n                        parent = this.placeEl.parent();\n                        this.placeEl.closest(opt.itemNodeName).after(this.placeEl);\n                        if (!parent.children().length) {\n                            this.unsetParent(parent.parent());\n                        }\n                    }\n                }\n            }\n\n            var isEmpty = false;\n\n            // find list item under cursor\n            if (!hasPointerEvents) {\n                this.dragEl[0].style.visibility = 'hidden';\n            }\n            this.pointEl = $(document.elementFromPoint(e.pageX - document.body.scrollLeft, e.pageY - (window.pageYOffset || document.documentElement.scrollTop)));\n            if (!hasPointerEvents) {\n                this.dragEl[0].style.visibility = 'visible';\n            }\n            if (this.pointEl.hasClass(opt.handleClass)) {\n                this.pointEl = this.pointEl.closest(opt.itemNodeName);\n            }\n            if (this.pointEl.hasClass(opt.emptyClass)) {\n                isEmpty = true;\n            }\n            else if (!this.pointEl.length || !this.pointEl.hasClass(opt.itemClass)) {\n                return;\n            }\n\n            // find parent list of item under cursor\n            var pointElRoot = this.pointEl.closest('.' + opt.rootClass),\n                isNewRoot = this.dragRootEl.data('nestable-id') !== pointElRoot.data('nestable-id');\n\n            /**\n             * move vertical\n             */\n            if (!mouse.dirAx || isNewRoot || isEmpty) {\n                // check if groups match if dragging over new root\n                if (isNewRoot && opt.group !== pointElRoot.data('nestable-group')) {\n                    return;\n                }\n\n                // fixed item's depth, use for some list has specific type, eg:'Volume, Section, Chapter ...'\n                if (this.options.fixedDepth && this.dragDepth + 1 !== this.pointEl.parents(opt.listNodeName).length) {\n                    return;\n                }\n\n                // check depth limit\n                depth = this.dragDepth - 1 + this.pointEl.parents(opt.listNodeName).length;\n                if (depth > opt.maxDepth) {\n                    return;\n                }\n                var before = e.pageY < (this.pointEl.offset().top + this.pointEl.height() / 2);\n                parent = this.placeEl.parent();\n                // if empty create new list to replace empty placeholder\n                if (isEmpty) {\n                    list = $(document.createElement(opt.listNodeName)).addClass(opt.listClass);\n                    list.append(this.placeEl);\n                    this.pointEl.replaceWith(list);\n                }\n                else if (before) {\n                    this.pointEl.before(this.placeEl);\n                }\n                else {\n                    this.pointEl.after(this.placeEl);\n                }\n                if (!parent.children().length) {\n                    this.unsetParent(parent.parent());\n                }\n                if (!this.dragRootEl.find(opt.itemNodeName).length) {\n                    this.appendEmptyElement(this.dragRootEl);\n                }\n                // parent root list has changed\n                this.dragRootEl = pointElRoot;\n                if (isNewRoot) {\n                    this.hasNewRoot = this.el[0] !== this.dragRootEl[0];\n                }\n            }\n        },\n\n        // Append the .dd-empty div to the list so it can be populated and styled\n        appendEmptyElement: function(element) {\n            element.append('<div class=\"' + this.options.emptyClass + '\"/>');\n        }\n    };\n\n    $.fn.nestable = function(params) {\n        var lists  = this,\n            retval = this,\n            args   = arguments;\n\n        if (!('Nestable' in window)) {\n            window.Nestable = {};\n            Nestable.counter = 0;\n        }\n\n        lists.each(function() {\n            var plugin = $(this).data(\"nestable\");\n\n            if (!plugin) {\n                Nestable.counter++;\n                $(this).data(\"nestable\", new Plugin(this, params));\n                $(this).data(\"nestable-id\", Nestable.counter);\n            }\n            else {\n                if (typeof params === 'string' && typeof plugin[params] === 'function') {\n                    if (args.length > 1){\n                        var pluginArgs = [];\n                        for (var i = 1; i < args.length; i++) {\n                            pluginArgs.push(args[i]);\n                        }\n                        retval = plugin[params].apply(plugin, pluginArgs);\n                    }\n                    else {\n                        retval = plugin[params]();\n                    }\n                }\n            }\n        });\n\n        return retval || lists;\n    };\n\n})(window.jQuery || window.Zepto, window, document);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvbmVzdGFibGUyL2pxdWVyeS5uZXN0YWJsZS5qcz9lODY0Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0EseUNBQXlDLG9EQUFvRDtBQUM3RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Qsc0NBQXNDO0FBQ3RDLHlDQUF5QztBQUN6Qyw0Q0FBNEM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGtDQUFrQzs7QUFFbEM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CLDhCQUE4QjtBQUM5Qiw4QkFBOEI7QUFDOUIsZ0NBQWdDO0FBQ2hDLGdDQUFnQztBQUNoQzs7QUFFQSxrRUFBa0UsZUFBZSxFQUFFO0FBQ25GOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBLGtDQUFrQzs7QUFFbEM7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsaUJBQWlCOztBQUVqQjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEM7QUFDMUM7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViLHlDQUF5Qyx3QkFBd0IsRUFBRTtBQUNuRTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw4QkFBOEIsbUVBQW1FO0FBQ2pHOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUOztBQUVBLCtCQUErQjtBQUMvQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUOztBQUVBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQSxpQkFBaUI7O0FBRWpCO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0JBQWtCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxrRUFBa0U7QUFDbEU7QUFDQTtBQUNBLG9HQUFvRztBQUNwRztBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsdUJBQXVCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEsaUNBQWlDOztBQUVqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLGlCQUFpQjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUEsQ0FBQyIsImZpbGUiOiIuL25vZGVfbW9kdWxlcy9uZXN0YWJsZTIvanF1ZXJ5Lm5lc3RhYmxlLmpzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBOZXN0YWJsZSBqUXVlcnkgUGx1Z2luIC0gQ29weXJpZ2h0IChjKSAyMDE0IFJhbW9uIFNtaXQgLSBodHRwczovL2dpdGh1Yi5jb20vUmFtb25TbWl0L05lc3RhYmxlXG4gKi9cblxuKGZ1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuICAgIHZhciBoYXNUb3VjaCA9ICdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50O1xuXG4gICAgLyoqXG4gICAgICogRGV0ZWN0IENTUyBwb2ludGVyLWV2ZW50cyBwcm9wZXJ0eVxuICAgICAqIGV2ZW50cyBhcmUgbm9ybWFsbHkgZGlzYWJsZWQgb24gdGhlIGRyYWdnaW5nIGVsZW1lbnQgdG8gYXZvaWQgY29uZmxpY3RzXG4gICAgICogaHR0cHM6Ly9naXRodWIuY29tL2F1c2kvRmVhdHVyZS1kZXRlY3Rpb24tdGVjaG5pcXVlLWZvci1wb2ludGVyLWV2ZW50cy9ibG9iL21hc3Rlci9tb2Rlcm5penItcG9pbnRlcmV2ZW50cy5qc1xuICAgICAqL1xuICAgIHZhciBoYXNQb2ludGVyRXZlbnRzID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcbiAgICAgICAgICAgIGRvY0VsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICBpZiAoISgncG9pbnRlckV2ZW50cycgaW4gZWwuc3R5bGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWwuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdhdXRvJztcbiAgICAgICAgZWwuc3R5bGUucG9pbnRlckV2ZW50cyA9ICd4JztcbiAgICAgICAgZG9jRWwuYXBwZW5kQ2hpbGQoZWwpO1xuICAgICAgICB2YXIgc3VwcG9ydHMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSAmJiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCwgJycpLnBvaW50ZXJFdmVudHMgPT09ICdhdXRvJztcbiAgICAgICAgZG9jRWwucmVtb3ZlQ2hpbGQoZWwpO1xuICAgICAgICByZXR1cm4gISFzdXBwb3J0cztcbiAgICB9KSgpO1xuXG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgICBjb250ZW50Q2FsbGJhY2s6IGZ1bmN0aW9uKGl0ZW0pIHtyZXR1cm4gaXRlbS5jb250ZW50IHx8ICcnID8gaXRlbS5jb250ZW50IDogaXRlbS5pZDt9LFxuICAgICAgICBsaXN0Tm9kZU5hbWU6ICdvbCcsXG4gICAgICAgIGl0ZW1Ob2RlTmFtZTogJ2xpJyxcbiAgICAgICAgaGFuZGxlTm9kZU5hbWU6ICdkaXYnLFxuICAgICAgICBjb250ZW50Tm9kZU5hbWU6ICdzcGFuJyxcbiAgICAgICAgcm9vdENsYXNzOiAnZGQnLFxuICAgICAgICBsaXN0Q2xhc3M6ICdkZC1saXN0JyxcbiAgICAgICAgaXRlbUNsYXNzOiAnZGQtaXRlbScsXG4gICAgICAgIGRyYWdDbGFzczogJ2RkLWRyYWdlbCcsXG4gICAgICAgIGhhbmRsZUNsYXNzOiAnZGQtaGFuZGxlJyxcbiAgICAgICAgY29udGVudENsYXNzOiAnZGQtY29udGVudCcsXG4gICAgICAgIGNvbGxhcHNlZENsYXNzOiAnZGQtY29sbGFwc2VkJyxcbiAgICAgICAgcGxhY2VDbGFzczogJ2RkLXBsYWNlaG9sZGVyJyxcbiAgICAgICAgbm9EcmFnQ2xhc3M6ICdkZC1ub2RyYWcnLFxuICAgICAgICBub0NoaWxkcmVuQ2xhc3M6ICdkZC1ub2NoaWxkcmVuJyxcbiAgICAgICAgZW1wdHlDbGFzczogJ2RkLWVtcHR5JyxcbiAgICAgICAgZXhwYW5kQnRuSFRNTDogJzxidXR0b24gY2xhc3M9XCJkZC1leHBhbmRcIiBkYXRhLWFjdGlvbj1cImV4cGFuZFwiIHR5cGU9XCJidXR0b25cIj5FeHBhbmQ8L2J1dHRvbj4nLFxuICAgICAgICBjb2xsYXBzZUJ0bkhUTUw6ICc8YnV0dG9uIGNsYXNzPVwiZGQtY29sbGFwc2VcIiBkYXRhLWFjdGlvbj1cImNvbGxhcHNlXCIgdHlwZT1cImJ1dHRvblwiPkNvbGxhcHNlPC9idXR0b24+JyxcbiAgICAgICAgZ3JvdXA6IDAsXG4gICAgICAgIG1heERlcHRoOiA1LFxuICAgICAgICB0aHJlc2hvbGQ6IDIwLFxuICAgICAgICBmaXhlZERlcHRoOiBmYWxzZSwgLy9maXhlZCBpdGVtJ3MgZGVwdGhcbiAgICAgICAgZml4ZWQ6IGZhbHNlLFxuICAgICAgICBpbmNsdWRlQ29udGVudDogZmFsc2UsXG4gICAgICAgIHNjcm9sbDogZmFsc2UsXG4gICAgICAgIHNjcm9sbFNlbnNpdGl2aXR5OiAxLFxuICAgICAgICBzY3JvbGxTcGVlZDogNSxcbiAgICAgICAgc2Nyb2xsVHJpZ2dlcnM6IHtcbiAgICAgICAgICAgIHRvcDogNDAsXG4gICAgICAgICAgICBsZWZ0OiA0MCxcbiAgICAgICAgICAgIHJpZ2h0OiAtNDAsXG4gICAgICAgICAgICBib3R0b206IC00MFxuICAgICAgICB9LFxuICAgICAgICBlZmZlY3Q6IHtcbiAgICAgICAgICAgIGFuaW1hdGlvbjogJ25vbmUnLFxuICAgICAgICAgICAgdGltZTogJ3Nsb3cnXG4gICAgICAgIH0sXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihsLCBlLCBwKSB7fSxcbiAgICAgICAgb25EcmFnU3RhcnQ6IGZ1bmN0aW9uKGwsIGUsIHApIHt9LFxuICAgICAgICBiZWZvcmVEcmFnU3RvcDogZnVuY3Rpb24obCwgZSwgcCkge30sXG4gICAgICAgIGxpc3RSZW5kZXJlcjogZnVuY3Rpb24oY2hpbGRyZW4sIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHZhciBodG1sID0gJzwnICsgb3B0aW9ucy5saXN0Tm9kZU5hbWUgKyAnIGNsYXNzPVwiJyArIG9wdGlvbnMubGlzdENsYXNzICsgJ1wiPic7XG4gICAgICAgICAgICBodG1sICs9IGNoaWxkcmVuO1xuICAgICAgICAgICAgaHRtbCArPSAnPC8nICsgb3B0aW9ucy5saXN0Tm9kZU5hbWUgKyAnPic7XG5cbiAgICAgICAgICAgIHJldHVybiBodG1sO1xuICAgICAgICB9LFxuICAgICAgICBpdGVtUmVuZGVyZXI6IGZ1bmN0aW9uKGl0ZW1fYXR0cnMsIGNvbnRlbnQsIGNoaWxkcmVuLCBvcHRpb25zLCBpdGVtKSB7XG4gICAgICAgICAgICB2YXIgaXRlbV9hdHRyc19zdHJpbmcgPSAkLm1hcChpdGVtX2F0dHJzLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcgJyArIGtleSArICc9XCInICsgdmFsdWUgKyAnXCInO1xuICAgICAgICAgICAgfSkuam9pbignICcpO1xuXG4gICAgICAgICAgICB2YXIgaHRtbCA9ICc8JyArIG9wdGlvbnMuaXRlbU5vZGVOYW1lICsgaXRlbV9hdHRyc19zdHJpbmcgKyAnPic7XG4gICAgICAgICAgICBodG1sICs9ICc8JyArIG9wdGlvbnMuaGFuZGxlTm9kZU5hbWUgKyAnIGNsYXNzPVwiJyArIG9wdGlvbnMuaGFuZGxlQ2xhc3MgKyAnXCI+JztcbiAgICAgICAgICAgIGh0bWwgKz0gJzwnICsgb3B0aW9ucy5jb250ZW50Tm9kZU5hbWUgKyAnIGNsYXNzPVwiJyArIG9wdGlvbnMuY29udGVudENsYXNzICsgJ1wiPic7XG4gICAgICAgICAgICBodG1sICs9IGNvbnRlbnQ7XG4gICAgICAgICAgICBodG1sICs9ICc8LycgKyBvcHRpb25zLmNvbnRlbnROb2RlTmFtZSArICc+JztcbiAgICAgICAgICAgIGh0bWwgKz0gJzwvJyArIG9wdGlvbnMuaGFuZGxlTm9kZU5hbWUgKyAnPic7XG4gICAgICAgICAgICBodG1sICs9IGNoaWxkcmVuO1xuICAgICAgICAgICAgaHRtbCArPSAnPC8nICsgb3B0aW9ucy5pdGVtTm9kZU5hbWUgKyAnPic7XG5cbiAgICAgICAgICAgIHJldHVybiBodG1sO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIFBsdWdpbihlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMudyAgPSAkKGRvY3VtZW50KTtcbiAgICAgICAgdGhpcy5lbCA9ICQoZWxlbWVudCk7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IGRlZmF1bHRzO1xuXG4gICAgICAgIGlmIChvcHRpb25zLnJvb3RDbGFzcyAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMucm9vdENsYXNzICE9PSAnZGQnKSB7XG4gICAgICAgICAgICBvcHRpb25zLmxpc3RDbGFzcyAgICAgICA9IG9wdGlvbnMubGlzdENsYXNzID8gb3B0aW9ucy5saXN0Q2xhc3MgOiBvcHRpb25zLnJvb3RDbGFzcyArICctbGlzdCc7XG4gICAgICAgICAgICBvcHRpb25zLml0ZW1DbGFzcyAgICAgICA9IG9wdGlvbnMuaXRlbUNsYXNzID8gb3B0aW9ucy5pdGVtQ2xhc3MgOiBvcHRpb25zLnJvb3RDbGFzcyArICctaXRlbSc7XG4gICAgICAgICAgICBvcHRpb25zLmRyYWdDbGFzcyAgICAgICA9IG9wdGlvbnMuZHJhZ0NsYXNzID8gb3B0aW9ucy5kcmFnQ2xhc3MgOiBvcHRpb25zLnJvb3RDbGFzcyArICctZHJhZ2VsJztcbiAgICAgICAgICAgIG9wdGlvbnMuaGFuZGxlQ2xhc3MgICAgID0gb3B0aW9ucy5oYW5kbGVDbGFzcyA/IG9wdGlvbnMuaGFuZGxlQ2xhc3MgOiBvcHRpb25zLnJvb3RDbGFzcyArICctaGFuZGxlJztcbiAgICAgICAgICAgIG9wdGlvbnMuY29sbGFwc2VkQ2xhc3MgID0gb3B0aW9ucy5jb2xsYXBzZWRDbGFzcyA/IG9wdGlvbnMuY29sbGFwc2VkQ2xhc3MgOiBvcHRpb25zLnJvb3RDbGFzcyArICctY29sbGFwc2VkJztcbiAgICAgICAgICAgIG9wdGlvbnMucGxhY2VDbGFzcyAgICAgID0gb3B0aW9ucy5wbGFjZUNsYXNzID8gb3B0aW9ucy5wbGFjZUNsYXNzIDogb3B0aW9ucy5yb290Q2xhc3MgKyAnLXBsYWNlaG9sZGVyJztcbiAgICAgICAgICAgIG9wdGlvbnMubm9EcmFnQ2xhc3MgICAgID0gb3B0aW9ucy5ub0RyYWdDbGFzcyA/IG9wdGlvbnMubm9EcmFnQ2xhc3MgOiBvcHRpb25zLnJvb3RDbGFzcyArICctbm9kcmFnJztcbiAgICAgICAgICAgIG9wdGlvbnMubm9DaGlsZHJlbkNsYXNzID0gb3B0aW9ucy5ub0NoaWxkcmVuQ2xhc3MgPyBvcHRpb25zLm5vQ2hpbGRyZW5DbGFzcyA6IG9wdGlvbnMucm9vdENsYXNzICsgJy1ub2NoaWxkcmVuJztcbiAgICAgICAgICAgIG9wdGlvbnMuZW1wdHlDbGFzcyAgICAgID0gb3B0aW9ucy5lbXB0eUNsYXNzID8gb3B0aW9ucy5lbXB0eUNsYXNzIDogb3B0aW9ucy5yb290Q2xhc3MgKyAnLWVtcHR5JztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7XG5cbiAgICAgICAgLy8gYnVpbGQgSFRNTCBmcm9tIHNlcmlhbGl6ZWQgSlNPTiBpZiBwYXNzZWRcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5qc29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2J1aWxkKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG5cbiAgICBQbHVnaW4ucHJvdG90eXBlID0ge1xuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGxpc3QgPSB0aGlzO1xuXG4gICAgICAgICAgICBsaXN0LnJlc2V0KCk7XG4gICAgICAgICAgICBsaXN0LmVsLmRhdGEoJ25lc3RhYmxlLWdyb3VwJywgdGhpcy5vcHRpb25zLmdyb3VwKTtcbiAgICAgICAgICAgIGxpc3QucGxhY2VFbCA9ICQoJzxkaXYgY2xhc3M9XCInICsgbGlzdC5vcHRpb25zLnBsYWNlQ2xhc3MgKyAnXCIvPicpO1xuXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLmVsLmZpbmQobGlzdC5vcHRpb25zLml0ZW1Ob2RlTmFtZSk7XG4gICAgICAgICAgICAkLmVhY2goaXRlbXMsIGZ1bmN0aW9uKGssIGVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKGVsKSxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gaXRlbS5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICBsaXN0LnNldFBhcmVudChpdGVtKTtcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50Lmhhc0NsYXNzKGxpc3Qub3B0aW9ucy5jb2xsYXBzZWRDbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5jb2xsYXBzZUl0ZW0ocGFyZW50LnBhcmVudCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gQXBwZW5kIHRoZSAuZGQtZW1wdHkgZGl2IGlmIHRoZSBsaXN0IGRvbid0IGhhdmUgYW55IGl0ZW1zIG9uIGluaXRcbiAgICAgICAgICAgIGlmICghaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRFbXB0eUVsZW1lbnQodGhpcy5lbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxpc3QuZWwub24oJ2NsaWNrJywgJ2J1dHRvbicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAobGlzdC5kcmFnRWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpLFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSB0YXJnZXQuZGF0YSgnYWN0aW9uJyksXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gPSB0YXJnZXQucGFyZW50cyhsaXN0Lm9wdGlvbnMuaXRlbU5vZGVOYW1lKS5lcSgwKTtcbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnY29sbGFwc2UnKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QuY29sbGFwc2VJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnZXhwYW5kJykge1xuICAgICAgICAgICAgICAgICAgICBsaXN0LmV4cGFuZEl0ZW0oaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBvblN0YXJ0RXZlbnQgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGhhbmRsZSA9ICQoZS50YXJnZXQpO1xuICAgICAgICAgICAgICAgIGlmICghaGFuZGxlLmhhc0NsYXNzKGxpc3Qub3B0aW9ucy5oYW5kbGVDbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZS5jbG9zZXN0KCcuJyArIGxpc3Qub3B0aW9ucy5ub0RyYWdDbGFzcykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlID0gaGFuZGxlLmNsb3Nlc3QoJy4nICsgbGlzdC5vcHRpb25zLmhhbmRsZUNsYXNzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFoYW5kbGUubGVuZ3RoIHx8IGxpc3QuZHJhZ0VsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsaXN0LmlzVG91Y2ggPSAvXnRvdWNoLy50ZXN0KGUudHlwZSk7XG4gICAgICAgICAgICAgICAgaWYgKGxpc3QuaXNUb3VjaCAmJiBlLnRvdWNoZXMubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgbGlzdC5kcmFnU3RhcnQoZS50b3VjaGVzID8gZS50b3VjaGVzWzBdIDogZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25Nb3ZlRXZlbnQgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxpc3QuZHJhZ0VsKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5kcmFnTW92ZShlLnRvdWNoZXMgPyBlLnRvdWNoZXNbMF0gOiBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25FbmRFdmVudCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAobGlzdC5kcmFnRWwpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBsaXN0LmRyYWdTdG9wKGUudG91Y2hlcyA/IGUuY2hhbmdlZFRvdWNoZXNbMF0gOiBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoaGFzVG91Y2gpIHtcbiAgICAgICAgICAgICAgICBsaXN0LmVsWzBdLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBvblN0YXJ0RXZlbnQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgb25Nb3ZlRXZlbnQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBvbkVuZEV2ZW50LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgb25FbmRFdmVudCwgZmFsc2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaXN0LmVsLm9uKCdtb3VzZWRvd24nLCBvblN0YXJ0RXZlbnQpO1xuICAgICAgICAgICAgbGlzdC53Lm9uKCdtb3VzZW1vdmUnLCBvbk1vdmVFdmVudCk7XG4gICAgICAgICAgICBsaXN0Lncub24oJ21vdXNldXAnLCBvbkVuZEV2ZW50KTtcblxuICAgICAgICAgICAgdmFyIGRlc3Ryb3lOZXN0YWJsZSA9IGZ1bmN0aW9uKClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZiAoaGFzVG91Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5lbFswXS5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgb25TdGFydEV2ZW50LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBvbk1vdmVFdmVudCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBvbkVuZEV2ZW50LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGNhbmNlbCcsIG9uRW5kRXZlbnQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsaXN0LmVsLm9mZignbW91c2Vkb3duJywgb25TdGFydEV2ZW50KTtcbiAgICAgICAgICAgICAgICBsaXN0Lncub2ZmKCdtb3VzZW1vdmUnLCBvbk1vdmVFdmVudCk7XG4gICAgICAgICAgICAgICAgbGlzdC53Lm9mZignbW91c2V1cCcsIG9uRW5kRXZlbnQpO1xuXG4gICAgICAgICAgICAgICAgbGlzdC5lbC5vZmYoJ2NsaWNrJyk7XG4gICAgICAgICAgICAgICAgbGlzdC5lbC51bmJpbmQoJ2Rlc3Ryb3ktbmVzdGFibGUnKTtcblxuICAgICAgICAgICAgICAgIGxpc3QuZWwuZGF0YShcIm5lc3RhYmxlXCIsIG51bGwpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGlzdC5lbC5iaW5kKCdkZXN0cm95LW5lc3RhYmxlJywgZGVzdHJveU5lc3RhYmxlKTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuZWwudHJpZ2dlcignZGVzdHJveS1uZXN0YWJsZScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFkZDogZnVuY3Rpb24gKGl0ZW0pXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBsaXN0Q2xhc3NTZWxlY3RvciA9ICcuJyArIHRoaXMub3B0aW9ucy5saXN0Q2xhc3M7XG4gICAgICAgICAgICB2YXIgdHJlZSA9ICQodGhpcy5lbCkuY2hpbGRyZW4obGlzdENsYXNzU2VsZWN0b3IpO1xuXG4gICAgICAgICAgICBpZiAoaXRlbS5wYXJlbnRfaWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRyZWUgPSB0cmVlLmZpbmQoJ1tkYXRhLWlkPVwiJyArIGl0ZW0ucGFyZW50X2lkICsgJ1wiXScpO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnBhcmVudF9pZDtcblxuICAgICAgICAgICAgICAgIGlmICh0cmVlLmNoaWxkcmVuKGxpc3RDbGFzc1NlbGVjdG9yKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdHJlZSA9IHRyZWUuYXBwZW5kKHRoaXMub3B0aW9ucy5saXN0UmVuZGVyZXIoJycsIHRoaXMub3B0aW9ucykpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRyZWUgPSB0cmVlLmZpbmQobGlzdENsYXNzU2VsZWN0b3IgKyAnOmZpcnN0Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQYXJlbnQodHJlZS5wYXJlbnQoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRyZWUuYXBwZW5kKHRoaXMuX2J1aWxkSXRlbShpdGVtLCB0aGlzLm9wdGlvbnMpKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZXBsYWNlOiBmdW5jdGlvbiAoaXRlbSlcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIGh0bWwgPSB0aGlzLl9idWlsZEl0ZW0oaXRlbSwgdGhpcy5vcHRpb25zKTtcblxuICAgICAgICAgICAgdGhpcy5fZ2V0SXRlbUJ5SWQoaXRlbS5pZClcbiAgICAgICAgICAgICAgICAucmVwbGFjZVdpdGgoaHRtbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy9yZW1vdmVzIGl0ZW0gYW5kIGFkZGl0aW9uYWwgZWxlbWVudHMgZnJvbSBsaXN0XG4gICAgICAgIHJlbW92ZUl0ZW06IGZ1bmN0aW9uIChpdGVtKXtcbiAgICAgICAgICAgIHZhciBvcHRzID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIGVsICAgPSB0aGlzLmVsO1xuXG4gICAgICAgICAgICAvLyByZW1vdmUgaXRlbVxuICAgICAgICAgICAgaXRlbSA9IGl0ZW0gfHwgdGhpcztcbiAgICAgICAgICAgIGl0ZW0ucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIHJlbW92ZSBlbXB0eSBjaGlsZHJlbiBsaXN0c1xuICAgICAgICAgICAgdmFyIGVtcHR5TGlzdHNTZWxlY3RvciA9ICcuJyArIG9wdHMubGlzdENsYXNzXG4gICAgICAgICAgICAgICAgKyAnIC4nICsgb3B0cy5saXN0Q2xhc3MgKyAnOm5vdCg6aGFzKCopKSc7XG4gICAgICAgICAgICAkKGVsKS5maW5kKGVtcHR5TGlzdHNTZWxlY3RvcikucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIHJlbW92ZSBidXR0b25zIGlmIHBhcmVudHMgZG8gbm90IGhhdmUgY2hpbGRyZW5cbiAgICAgICAgICAgIHZhciBidXR0b25zU2VsZWN0b3IgPSAnW2RhdGEtYWN0aW9uPVwiZXhwYW5kXCJdLCBbZGF0YS1hY3Rpb249XCJjb2xsYXBzZVwiXSc7XG4gICAgICAgICAgICAkKGVsKS5maW5kKGJ1dHRvbnNTZWxlY3RvcikuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2libGluZ3MgPSAkKHRoaXMpLnNpYmxpbmdzKCcuJyArIG9wdHMubGlzdENsYXNzKTtcbiAgICAgICAgICAgICAgICBpZiAoc2libGluZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy9yZW1vdmVzIGl0ZW0gYnkgaXRlbUlkIGFuZCBydW4gY2FsbGJhY2sgYXQgdGhlIGVuZFxuICAgICAgICByZW1vdmU6IGZ1bmN0aW9uIChpdGVtSWQsIGNhbGxiYWNrKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgb3B0cyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBsaXN0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcy5fZ2V0SXRlbUJ5SWQoaXRlbUlkKTtcblxuICAgICAgICAgICAgLy9hbmltYXRpb24gc3R5bGVcbiAgICAgICAgICAgIHZhciBhbmltYXRpb24gPSBvcHRzLmVmZmVjdC5hbmltYXRpb24gfHwgJ2ZhZGUnO1xuXG4gICAgICAgICAgICAvL2FuaW1hdGlvbiB0aW1lXG4gICAgICAgICAgICB2YXIgdGltZSA9IG9wdHMuZWZmZWN0LnRpbWUgfHwgJ3Nsb3cnO1xuXG4gICAgICAgICAgICAvL2FkZCBmYWRlT3V0IGVmZmVjdCB3aGVuIHJlbW92aW5nXG4gICAgICAgICAgICBpZiAoYW5pbWF0aW9uID09PSAnZmFkZScpe1xuICAgICAgICAgICAgICAgIGl0ZW0uZmFkZU91dCh0aW1lLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBsaXN0LnJlbW92ZUl0ZW0oaXRlbSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUl0ZW0oaXRlbSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvL3JlbW92ZXMgYWxsIGl0ZW1zIGZyb20gdGhlIGxpc3QgYW5kIHJ1biBjYWxsYmFjayBhdCB0aGUgZW5kXG4gICAgICAgIHJlbW92ZUFsbDogZnVuY3Rpb24oY2FsbGJhY2spe1xuXG4gICAgICAgICAgICB2YXIgbGlzdCAgPSB0aGlzLFxuICAgICAgICAgICAgICAgIG9wdHMgID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIG5vZGUgID0gbGlzdC5lbC5maW5kKG9wdHMubGlzdE5vZGVOYW1lKS5maXJzdCgpLFxuICAgICAgICAgICAgICAgIGl0ZW1zID0gbm9kZS5jaGlsZHJlbihvcHRzLml0ZW1Ob2RlTmFtZSk7XG5cbiAgICAgICAgICAgIC8vYW5pbWF0aW9uIHN0eWxlXG4gICAgICAgICAgICB2YXIgYW5pbWF0aW9uID0gb3B0cy5lZmZlY3QuYW5pbWF0aW9uIHx8ICdmYWRlJztcblxuICAgICAgICAgICAgLy9hbmltYXRpb24gdGltZVxuICAgICAgICAgICAgdmFyIHRpbWUgPSBvcHRzLmVmZmVjdC50aW1lIHx8ICdzbG93JztcblxuICAgICAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKCl7XG4gICAgICAgICAgICAgICAgLy9SZW1vdmVzIGVhY2ggaXRlbSBhbmQgaXRzIGNoaWxkcmVuLlxuICAgICAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QucmVtb3ZlSXRlbSgkKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvL05vdyB3ZSBjYW4gYWdhaW4gc2hvdyBvdXIgbm9kZSBlbGVtZW50XG4gICAgICAgICAgICAgICAgbm9kZS5zaG93KCk7XG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL2FkZCBmYWRlT3V0IGVmZmVjdCB3aGVuIHJlbW92aW5nXG4gICAgICAgICAgICBpZiAoYW5pbWF0aW9uID09PSAnZmFkZScpe1xuICAgICAgICAgICAgICAgIG5vZGUuZmFkZU91dCh0aW1lLCByZW1vdmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2dldEl0ZW1CeUlkOiBmdW5jdGlvbihpdGVtSWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMuZWwpLmNoaWxkcmVuKCcuJyArIHRoaXMub3B0aW9ucy5saXN0Q2xhc3MpXG4gICAgICAgICAgICAgICAgLmZpbmQoJ1tkYXRhLWlkPVwiJyArIGl0ZW1JZCArICdcIl0nKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfYnVpbGQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGpzb24gPSB0aGlzLm9wdGlvbnMuanNvbjtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBqc29uID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGpzb24gPSBKU09OLnBhcnNlKGpzb24pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkKHRoaXMuZWwpLmh0bWwodGhpcy5fYnVpbGRMaXN0KGpzb24sIHRoaXMub3B0aW9ucykpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9idWlsZExpc3Q6IGZ1bmN0aW9uKGl0ZW1zLCBvcHRpb25zKSB7XG4gICAgICAgICAgICBpZiAoIWl0ZW1zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSAnJztcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgJC5lYWNoKGl0ZW1zLCBmdW5jdGlvbihpbmRleCwgc3ViKSB7XG4gICAgICAgICAgICAgICAgY2hpbGRyZW4gKz0gdGhhdC5fYnVpbGRJdGVtKHN1Yiwgb3B0aW9ucyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMubGlzdFJlbmRlcmVyKGNoaWxkcmVuLCBvcHRpb25zKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfYnVpbGRJdGVtOiBmdW5jdGlvbihpdGVtLCBvcHRpb25zKSB7XG4gICAgICAgICAgICBmdW5jdGlvbiBlc2NhcGVIdG1sKHRleHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWFwID0ge1xuICAgICAgICAgICAgICAgICAgICAnJic6ICcmYW1wOycsXG4gICAgICAgICAgICAgICAgICAgICc8JzogJyZsdDsnLFxuICAgICAgICAgICAgICAgICAgICAnPic6ICcmZ3Q7JyxcbiAgICAgICAgICAgICAgICAgICAgJ1wiJzogJyZxdW90OycsXG4gICAgICAgICAgICAgICAgICAgIFwiJ1wiOiAnJiMwMzk7J1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGV4dCArIFwiXCIucmVwbGFjZSgvWyY8PlwiJ10vZywgZnVuY3Rpb24obSkgeyByZXR1cm4gbWFwW21dOyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZmlsdGVyQ2xhc3NlcyhjbGFzc2VzKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld19jbGFzc2VzID0ge307XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrIGluIGNsYXNzZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXNcbiAgICAgICAgICAgICAgICAgICAgbmV3X2NsYXNzZXNbY2xhc3Nlc1trXV0gPSBjbGFzc2VzW2tdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBuZXdfY2xhc3NlcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ2xhc3Nlc1N0cmluZyhpdGVtLCBvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNsYXNzZXMgPSBpdGVtLmNsYXNzZXMgfHwge307XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNsYXNzZXMgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzZXMgPSBbY2xhc3Nlc107XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1fY2xhc3NlcyA9IGZpbHRlckNsYXNzZXMoY2xhc3Nlcyk7XG4gICAgICAgICAgICAgICAgaXRlbV9jbGFzc2VzW29wdGlvbnMuaXRlbUNsYXNzXSA9IG9wdGlvbnMuaXRlbUNsYXNzO1xuXG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIGNsYXNzIHN0cmluZ1xuICAgICAgICAgICAgICAgIHJldHVybiAkLm1hcChpdGVtX2NsYXNzZXMsIGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgICAgICAgICAgIH0pLmpvaW4oJyAnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlRGF0YUF0dHJzKGF0dHIpIHtcbiAgICAgICAgICAgICAgICBhdHRyID0gJC5leHRlbmQoe30sIGF0dHIpO1xuXG4gICAgICAgICAgICAgICAgZGVsZXRlIGF0dHIuY2hpbGRyZW47XG4gICAgICAgICAgICAgICAgZGVsZXRlIGF0dHIuY2xhc3NlcztcbiAgICAgICAgICAgICAgICBkZWxldGUgYXR0ci5jb250ZW50O1xuXG4gICAgICAgICAgICAgICAgdmFyIGRhdGFfYXR0cnMgPSB7fTtcblxuICAgICAgICAgICAgICAgICQuZWFjaChhdHRyLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGRhdGFfYXR0cnNbXCJkYXRhLVwiICsga2V5XSA9IGVzY2FwZUh0bWwodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFfYXR0cnM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpdGVtX2F0dHJzID0gY3JlYXRlRGF0YUF0dHJzKGl0ZW0pO1xuICAgICAgICAgICAgaXRlbV9hdHRyc1tcImNsYXNzXCJdID0gY3JlYXRlQ2xhc3Nlc1N0cmluZyhpdGVtLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBvcHRpb25zLmNvbnRlbnRDYWxsYmFjayhpdGVtKTtcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuX2J1aWxkTGlzdChpdGVtLmNoaWxkcmVuLCBvcHRpb25zKTtcbiAgICAgICAgICAgIHZhciBodG1sID0gJChvcHRpb25zLml0ZW1SZW5kZXJlcihpdGVtX2F0dHJzLCBjb250ZW50LCBjaGlsZHJlbiwgb3B0aW9ucywgaXRlbSkpO1xuXG4gICAgICAgICAgICB0aGlzLnNldFBhcmVudChodG1sKTtcblxuICAgICAgICAgICAgcmV0dXJuIGh0bWxbMF0ub3V0ZXJIVE1MO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNlcmlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSwgbGlzdCA9IHRoaXMsIHN0ZXAgPSBmdW5jdGlvbihsZXZlbCkge1xuICAgICAgICAgICAgICAgIHZhciBhcnJheSA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBpdGVtcyA9IGxldmVsLmNoaWxkcmVuKGxpc3Qub3B0aW9ucy5pdGVtTm9kZU5hbWUpO1xuICAgICAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsaSA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gJC5leHRlbmQoe30sIGxpLmRhdGEoKSksXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWIgPSBsaS5jaGlsZHJlbihsaXN0Lm9wdGlvbnMubGlzdE5vZGVOYW1lKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAobGlzdC5vcHRpb25zLmluY2x1ZGVDb250ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IGxpLmZpbmQoJy4nICsgbGlzdC5vcHRpb25zLmNvbnRlbnRDbGFzcykuaHRtbCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY29udGVudCA9IGNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoc3ViLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jaGlsZHJlbiA9IHN0ZXAoc3ViKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBhcnJheS5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBhcnJheTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBkYXRhID0gc3RlcChsaXN0LmVsLmZpbmQobGlzdC5vcHRpb25zLmxpc3ROb2RlTmFtZSkuZmlyc3QoKSk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfSxcblxuICAgICAgICBhc05lc3RlZFNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgbGlzdCA9IHRoaXMsIG8gPSBsaXN0Lm9wdGlvbnMsIGRlcHRoID0gLTEsIHJldCA9IFtdLCBsZnQgPSAxO1xuICAgICAgICAgICAgdmFyIGl0ZW1zID0gbGlzdC5lbC5maW5kKG8ubGlzdE5vZGVOYW1lKS5maXJzdCgpLmNoaWxkcmVuKG8uaXRlbU5vZGVOYW1lKTtcblxuICAgICAgICAgICAgaXRlbXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgbGZ0ID0gdHJhdmVyc2UodGhpcywgZGVwdGggKyAxLCBsZnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldCA9IHJldC5zb3J0KGZ1bmN0aW9uKGEsYil7IHJldHVybiAoYS5sZnQgLSBiLmxmdCk7IH0pO1xuICAgICAgICAgICAgcmV0dXJuIHJldDtcblxuICAgICAgICAgICAgZnVuY3Rpb24gdHJhdmVyc2UoaXRlbSwgZGVwdGgsIGxmdCkge1xuICAgICAgICAgICAgICAgIHZhciByZ3QgPSBsZnQgKyAxLCBpZCwgcGlkO1xuXG4gICAgICAgICAgICAgICAgaWYgKCQoaXRlbSkuY2hpbGRyZW4oby5saXN0Tm9kZU5hbWUpLmNoaWxkcmVuKG8uaXRlbU5vZGVOYW1lKS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgICAgICAgICBkZXB0aCsrO1xuICAgICAgICAgICAgICAgICAgICAkKGl0ZW0pLmNoaWxkcmVuKG8ubGlzdE5vZGVOYW1lKS5jaGlsZHJlbihvLml0ZW1Ob2RlTmFtZSkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZ3QgPSB0cmF2ZXJzZSgkKHRoaXMpLCBkZXB0aCwgcmd0KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGRlcHRoLS07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWQgPSAkKGl0ZW0pLmF0dHIoJ2RhdGEtaWQnKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNJbnQoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlkID0gcGFyc2VJbnQoaWQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHBpZCA9ICQoaXRlbSkucGFyZW50KG8ubGlzdE5vZGVOYW1lKS5wYXJlbnQoby5pdGVtTm9kZU5hbWUpLmF0dHIoJ2RhdGEtaWQnKSB8fCAnJztcbiAgICAgICAgICAgICAgICBpZiAoaXNJbnQocGlkKSkge1xuICAgICAgICAgICAgICAgICAgICBpZCA9IHBhcnNlSW50KHBpZCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldC5wdXNoKHtcImlkXCI6IGlkLCBcInBhcmVudF9pZFwiOiBwaWQsIFwiZGVwdGhcIjogZGVwdGgsIFwibGZ0XCI6IGxmdCwgXCJyZ3RcIjogcmd0fSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGZ0ID0gcmd0ICsgMTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGZ0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBpc0ludCh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkLmlzTnVtZXJpYyh2YWx1ZSkgJiYgTWF0aC5mbG9vcih2YWx1ZSkgPT0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmV0dXJuT3B0aW9uczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNlcmlhbGlzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJpYWxpemUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0hpZXJhcmNoeTogZnVuY3Rpb24ob3B0aW9ucykge1xuXG4gICAgICAgICAgICB2YXIgbyA9ICQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpLFxuICAgICAgICAgICAgICAgIHJldCA9IFtdO1xuXG4gICAgICAgICAgICAkKHRoaXMuZWxlbWVudCkuY2hpbGRyZW4oby5pdGVtcykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGV2ZWwgPSBfcmVjdXJzaXZlSXRlbXModGhpcyk7XG4gICAgICAgICAgICAgICAgcmV0LnB1c2gobGV2ZWwpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXQ7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9yZWN1cnNpdmVJdGVtcyhpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gKCQoaXRlbSkuYXR0cihvLmF0dHJpYnV0ZSB8fCAnaWQnKSB8fCAnJykubWF0Y2goby5leHByZXNzaW9uIHx8ICgvKC4rKVstPV9dKC4rKS8pKTtcbiAgICAgICAgICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRJdGVtID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBpZFsyXVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpZiAoJChpdGVtKS5jaGlsZHJlbihvLmxpc3RUeXBlKS5jaGlsZHJlbihvLml0ZW1zKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50SXRlbS5jaGlsZHJlbiA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChpdGVtKS5jaGlsZHJlbihvLmxpc3RUeXBlKS5jaGlsZHJlbihvLml0ZW1zKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZXZlbCA9IF9yZWN1cnNpdmVJdGVtcyh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50SXRlbS5jaGlsZHJlbi5wdXNoKGxldmVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50SXRlbTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9BcnJheTogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciBvID0gJC5leHRlbmQoe30sIHRoaXMub3B0aW9ucywgdGhpcyksXG4gICAgICAgICAgICAgICAgc0RlcHRoID0gby5zdGFydERlcHRoQ291bnQgfHwgMCxcbiAgICAgICAgICAgICAgICByZXQgPSBbXSxcbiAgICAgICAgICAgICAgICBsZWZ0ID0gMixcbiAgICAgICAgICAgICAgICBsaXN0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gbGlzdC5lbC5maW5kKGxpc3Qub3B0aW9ucy5saXN0Tm9kZU5hbWUpLmZpcnN0KCk7XG5cbiAgICAgICAgICAgIHZhciBpdGVtcyA9IGVsZW1lbnQuY2hpbGRyZW4obGlzdC5vcHRpb25zLml0ZW1Ob2RlTmFtZSk7XG4gICAgICAgICAgICBpdGVtcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxlZnQgPSBfcmVjdXJzaXZlQXJyYXkoJCh0aGlzKSwgc0RlcHRoICsgMSwgbGVmdCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0ID0gcmV0LnNvcnQoZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgICAgIHJldHVybiAoYS5sZWZ0IC0gYi5sZWZ0KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBfcmVjdXJzaXZlQXJyYXkoaXRlbSwgZGVwdGgsIGxlZnQpIHtcblxuICAgICAgICAgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyAxLFxuICAgICAgICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgICAgICAgcGlkO1xuXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4oby5vcHRpb25zLmxpc3ROb2RlTmFtZSkuY2hpbGRyZW4oby5vcHRpb25zLml0ZW1Ob2RlTmFtZSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBkZXB0aCsrO1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmNoaWxkcmVuKG8ub3B0aW9ucy5saXN0Tm9kZU5hbWUpLmNoaWxkcmVuKG8ub3B0aW9ucy5pdGVtTm9kZU5hbWUpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByaWdodCA9IF9yZWN1cnNpdmVBcnJheSgkKHRoaXMpLCBkZXB0aCwgcmlnaHQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZGVwdGgtLTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZCA9IGl0ZW0uZGF0YSgpLmlkO1xuXG5cbiAgICAgICAgICAgICAgICBpZiAoZGVwdGggPT09IHNEZXB0aCArIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcGlkID0gby5yb290SUQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50SXRlbSA9IChpdGVtLnBhcmVudChvLm9wdGlvbnMubGlzdE5vZGVOYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnBhcmVudChvLm9wdGlvbnMuaXRlbU5vZGVOYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoKSk7XG4gICAgICAgICAgICAgICAgICAgIHBpZCA9IHBhcmVudEl0ZW0uaWQ7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicGFyZW50X2lkXCI6IHBpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVwdGhcIjogZGVwdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxlZnRcIjogbGVmdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicmlnaHRcIjogcmlnaHRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGVmdCA9IHJpZ2h0ICsgMTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMubW91c2UgPSB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0WDogMCxcbiAgICAgICAgICAgICAgICBvZmZzZXRZOiAwLFxuICAgICAgICAgICAgICAgIHN0YXJ0WDogMCxcbiAgICAgICAgICAgICAgICBzdGFydFk6IDAsXG4gICAgICAgICAgICAgICAgbGFzdFg6IDAsXG4gICAgICAgICAgICAgICAgbGFzdFk6IDAsXG4gICAgICAgICAgICAgICAgbm93WDogMCxcbiAgICAgICAgICAgICAgICBub3dZOiAwLFxuICAgICAgICAgICAgICAgIGRpc3RYOiAwLFxuICAgICAgICAgICAgICAgIGRpc3RZOiAwLFxuICAgICAgICAgICAgICAgIGRpckF4OiAwLFxuICAgICAgICAgICAgICAgIGRpclg6IDAsXG4gICAgICAgICAgICAgICAgZGlyWTogMCxcbiAgICAgICAgICAgICAgICBsYXN0RGlyWDogMCxcbiAgICAgICAgICAgICAgICBsYXN0RGlyWTogMCxcbiAgICAgICAgICAgICAgICBkaXN0QXhYOiAwLFxuICAgICAgICAgICAgICAgIGRpc3RBeFk6IDBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLmlzVG91Y2ggPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMubW92aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmRyYWdFbCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmRyYWdSb290RWwgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5kcmFnRGVwdGggPSAwO1xuICAgICAgICAgICAgdGhpcy5oYXNOZXdSb290ID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnBvaW50RWwgPSBudWxsO1xuICAgICAgICB9LFxuXG4gICAgICAgIGV4cGFuZEl0ZW06IGZ1bmN0aW9uKGxpKSB7XG4gICAgICAgICAgICBsaS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuY29sbGFwc2VkQ2xhc3MpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbGxhcHNlSXRlbTogZnVuY3Rpb24obGkpIHtcbiAgICAgICAgICAgIHZhciBsaXN0cyA9IGxpLmNoaWxkcmVuKHRoaXMub3B0aW9ucy5saXN0Tm9kZU5hbWUpO1xuICAgICAgICAgICAgaWYgKGxpc3RzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGxpLmFkZENsYXNzKHRoaXMub3B0aW9ucy5jb2xsYXBzZWRDbGFzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXhwYW5kQWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBsaXN0ID0gdGhpcztcbiAgICAgICAgICAgIGxpc3QuZWwuZmluZChsaXN0Lm9wdGlvbnMuaXRlbU5vZGVOYW1lKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxpc3QuZXhwYW5kSXRlbSgkKHRoaXMpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbGxhcHNlQWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBsaXN0ID0gdGhpcztcbiAgICAgICAgICAgIGxpc3QuZWwuZmluZChsaXN0Lm9wdGlvbnMuaXRlbU5vZGVOYW1lKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxpc3QuY29sbGFwc2VJdGVtKCQodGhpcykpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0UGFyZW50OiBmdW5jdGlvbihsaSkge1xuICAgICAgICAgICAgLy9DaGVjayBpZiBsaSBpcyBhbiBlbGVtZW50IG9mIGl0ZW1Ob2RlTmFtZSB0eXBlIGFuZCBoYXMgY2hpbGRyZW5cbiAgICAgICAgICAgIGlmIChsaS5pcyh0aGlzLm9wdGlvbnMuaXRlbU5vZGVOYW1lKSAmJiBsaS5jaGlsZHJlbih0aGlzLm9wdGlvbnMubGlzdE5vZGVOYW1lKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgTk9UIHNob3dpbmcgdHdvIG9yIG1vcmUgc2V0cyBkYXRhLWFjdGlvbiBidXR0b25zXG4gICAgICAgICAgICAgICAgbGkuY2hpbGRyZW4oJ1tkYXRhLWFjdGlvbl0nKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBsaS5wcmVwZW5kKCQodGhpcy5vcHRpb25zLmV4cGFuZEJ0bkhUTUwpKTtcbiAgICAgICAgICAgICAgICBsaS5wcmVwZW5kKCQodGhpcy5vcHRpb25zLmNvbGxhcHNlQnRuSFRNTCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVuc2V0UGFyZW50OiBmdW5jdGlvbihsaSkge1xuICAgICAgICAgICAgbGkucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmNvbGxhcHNlZENsYXNzKTtcbiAgICAgICAgICAgIGxpLmNoaWxkcmVuKCdbZGF0YS1hY3Rpb25dJykucmVtb3ZlKCk7XG4gICAgICAgICAgICBsaS5jaGlsZHJlbih0aGlzLm9wdGlvbnMubGlzdE5vZGVOYW1lKS5yZW1vdmUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkcmFnU3RhcnQ6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciBtb3VzZSA9IHRoaXMubW91c2UsXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gJChlLnRhcmdldCksXG4gICAgICAgICAgICAgICAgZHJhZ0l0ZW0gPSB0YXJnZXQuY2xvc2VzdCh0aGlzLm9wdGlvbnMuaXRlbU5vZGVOYW1lKSxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wICA6IGUucGFnZVksXG4gICAgICAgICAgICAgICAgICAgIGxlZnQgOiBlLnBhZ2VYXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGNvbnRpbnVlRXhlY3V0aW9uID0gdGhpcy5vcHRpb25zLm9uRHJhZ1N0YXJ0LmNhbGwodGhpcywgdGhpcy5lbCwgZHJhZ0l0ZW0sIHBvc2l0aW9uKTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb250aW51ZUV4ZWN1dGlvbiAhPT0gJ3VuZGVmaW5lZCcgJiYgY29udGludWVFeGVjdXRpb24gPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnBsYWNlRWwuY3NzKCdoZWlnaHQnLCBkcmFnSXRlbS5oZWlnaHQoKSk7XG5cbiAgICAgICAgICAgIG1vdXNlLm9mZnNldFggPSBlLnBhZ2VYIC0gZHJhZ0l0ZW0ub2Zmc2V0KCkubGVmdDtcbiAgICAgICAgICAgIG1vdXNlLm9mZnNldFkgPSBlLnBhZ2VZIC0gZHJhZ0l0ZW0ub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgbW91c2Uuc3RhcnRYID0gbW91c2UubGFzdFggPSBlLnBhZ2VYO1xuICAgICAgICAgICAgbW91c2Uuc3RhcnRZID0gbW91c2UubGFzdFkgPSBlLnBhZ2VZO1xuXG4gICAgICAgICAgICB0aGlzLmRyYWdSb290RWwgPSB0aGlzLmVsO1xuICAgICAgICAgICAgdGhpcy5kcmFnRWwgPSAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGhpcy5vcHRpb25zLmxpc3ROb2RlTmFtZSkpLmFkZENsYXNzKHRoaXMub3B0aW9ucy5saXN0Q2xhc3MgKyAnICcgKyB0aGlzLm9wdGlvbnMuZHJhZ0NsYXNzKTtcbiAgICAgICAgICAgIHRoaXMuZHJhZ0VsLmNzcygnd2lkdGgnLCBkcmFnSXRlbS5vdXRlcldpZHRoKCkpO1xuXG4gICAgICAgICAgICB0aGlzLnNldEluZGV4T2ZJdGVtKGRyYWdJdGVtKTtcblxuICAgICAgICAgICAgLy8gZml4IGZvciB6ZXB0by5qc1xuICAgICAgICAgICAgLy9kcmFnSXRlbS5hZnRlcih0aGlzLnBsYWNlRWwpLmRldGFjaCgpLmFwcGVuZFRvKHRoaXMuZHJhZ0VsKTtcbiAgICAgICAgICAgIGRyYWdJdGVtLmFmdGVyKHRoaXMucGxhY2VFbCk7XG4gICAgICAgICAgICBkcmFnSXRlbVswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGRyYWdJdGVtWzBdKTtcbiAgICAgICAgICAgIGRyYWdJdGVtLmFwcGVuZFRvKHRoaXMuZHJhZ0VsKTtcblxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5hcHBlbmQodGhpcy5kcmFnRWwpO1xuICAgICAgICAgICAgdGhpcy5kcmFnRWwuY3NzKHtcbiAgICAgICAgICAgICAgICAnbGVmdCc6IGUucGFnZVggLSBtb3VzZS5vZmZzZXRYLFxuICAgICAgICAgICAgICAgICd0b3AnOiBlLnBhZ2VZIC0gbW91c2Uub2Zmc2V0WVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyB0b3RhbCBkZXB0aCBvZiBkcmFnZ2luZyBpdGVtXG4gICAgICAgICAgICB2YXIgaSwgZGVwdGgsXG4gICAgICAgICAgICAgICAgaXRlbXMgPSB0aGlzLmRyYWdFbC5maW5kKHRoaXMub3B0aW9ucy5pdGVtTm9kZU5hbWUpO1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZGVwdGggPSAkKGl0ZW1zW2ldKS5wYXJlbnRzKHRoaXMub3B0aW9ucy5saXN0Tm9kZU5hbWUpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAoZGVwdGggPiB0aGlzLmRyYWdEZXB0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYWdEZXB0aCA9IGRlcHRoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvL0NyZWF0ZSBzdWJsZXZlbC5cbiAgICAgICAgLy8gIGVsZW1lbnQgOiBlbGVtZW50IHdoaWNoIGJlY29tZSBwYXJlbnRcbiAgICAgICAgLy8gIGl0ZW0gICAgOiBzb21ldGhpbmcgdG8gcGxhY2UgaW50byBuZXcgc3VibGV2ZWxcbiAgICAgICAgY3JlYXRlU3ViTGV2ZWw6IGZ1bmN0aW9uKGVsZW1lbnQsIGl0ZW0pIHtcbiAgICAgICAgICAgIHZhciBsaXN0ID0gJCgnPCcgKyB0aGlzLm9wdGlvbnMubGlzdE5vZGVOYW1lICsgJy8+JykuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmxpc3RDbGFzcyk7XG4gICAgICAgICAgICBpZiAoaXRlbSkgbGlzdC5hcHBlbmQoaXRlbSk7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZChsaXN0KTtcbiAgICAgICAgICAgIHRoaXMuc2V0UGFyZW50KGVsZW1lbnQpO1xuICAgICAgICAgICAgcmV0dXJuIGxpc3Q7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0SW5kZXhPZkl0ZW06IGZ1bmN0aW9uKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICBpbmRleCA9IGluZGV4IHx8IFtdO1xuXG4gICAgICAgICAgICBpbmRleC51bnNoaWZ0KGl0ZW0uaW5kZXgoKSk7XG5cbiAgICAgICAgICAgIGlmICgkKGl0ZW1bMF0ucGFyZW50Tm9kZSlbMF0gIT09IHRoaXMuZHJhZ1Jvb3RFbFswXSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0SW5kZXhPZkl0ZW0oJChpdGVtWzBdLnBhcmVudE5vZGUpLCBpbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdFbC5kYXRhKCdpbmRleE9mSXRlbScsIGluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZXN0b3JlSXRlbUF0SW5kZXg6IGZ1bmN0aW9uKGRyYWdFbGVtZW50LCBpbmRleEFycmF5KSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudEVsID0gdGhpcy5lbCxcbiAgICAgICAgICAgICAgICBsYXN0SW5kZXggPSBpbmRleEFycmF5Lmxlbmd0aCAtIDE7XG5cbiAgICAgICAgICAgIC8vUHV0IGRyYWcgZWxlbWVudCBhdCBjdXJyZW50IGVsZW1lbnQgcG9zaXRpb24uXG4gICAgICAgICAgICBmdW5jdGlvbiBwbGFjZUVsZW1lbnQoY3VycmVudEVsLCBkcmFnRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmIChpbmRleEFycmF5W2xhc3RJbmRleF0gPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgJChjdXJyZW50RWwpLnByZXBlbmQoZHJhZ0VsZW1lbnQuY2xvbmUodHJ1ZSkpOyAvL3VzaW5nIHRydWUgc2F2ZXMgYWRkZWQgdG8gZWxlbWVudCBldmVudHMuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKGN1cnJlbnRFbC5jaGlsZHJlbltpbmRleEFycmF5W2xhc3RJbmRleF0gLSAxXSkuYWZ0ZXIoZHJhZ0VsZW1lbnQuY2xvbmUodHJ1ZSkpOyAvL3VzaW5nIHRydWUgc2F2ZXMgYWRkZWQgdG8gZWxlbWVudCBldmVudHMuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9EaWdnaW4gdGhyb3VnaCBpbmRleEFycmF5IHRvIGdldCBob21lIGZvciBkcmFnRWxlbWVudC5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kZXhBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChsYXN0SW5kZXggPT09IHBhcnNlSW50KGkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlRWxlbWVudChjdXJyZW50RWwsIGRyYWdFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL2VsZW1lbnQgY2FuIGhhdmUgbm8gaW5kZXhlcywgc28gd2UgaGF2ZSB0byB1c2UgY29uZGl0aW9uYWwgaGVyZSB0byBhdm9pZCBlcnJvcnMuXG4gICAgICAgICAgICAgICAgLy9pZiBlbGVtZW50IGRvZXNuJ3QgZXhpc3Qgd2UgZGVmZW5ldGx5IG5lZWQgdG8gYWRkIG5ldyBsaXN0LlxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gKGN1cnJlbnRFbFswXSkgPyBjdXJyZW50RWxbMF0gOiBjdXJyZW50RWw7XG4gICAgICAgICAgICAgICAgdmFyIG5leHRFbCAgPSBlbGVtZW50LmNoaWxkcmVuW2luZGV4QXJyYXlbaV1dO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRFbCAgID0gKCFuZXh0RWwpID8gdGhpcy5jcmVhdGVTdWJMZXZlbCgkKGVsZW1lbnQpKSA6IG5leHRFbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkcmFnU3RvcDogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgLy8gZml4IGZvciB6ZXB0by5qc1xuICAgICAgICAgICAgLy90aGlzLnBsYWNlRWwucmVwbGFjZVdpdGgodGhpcy5kcmFnRWwuY2hpbGRyZW4odGhpcy5vcHRpb25zLml0ZW1Ob2RlTmFtZSArICc6Zmlyc3QnKS5kZXRhY2goKSk7XG4gICAgICAgICAgICB2YXIgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgdG9wICA6IGUucGFnZVksXG4gICAgICAgICAgICAgICAgbGVmdCA6IGUucGFnZVhcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvL0dldCBpbmRleEFycmF5IG9mIGl0ZW0gYXQgZHJhZyBzdGFydC5cbiAgICAgICAgICAgIHZhciBzcmNJbmRleCA9IHRoaXMuZHJhZ0VsLmRhdGEoJ2luZGV4T2ZJdGVtJyk7XG5cbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXMuZHJhZ0VsLmNoaWxkcmVuKHRoaXMub3B0aW9ucy5pdGVtTm9kZU5hbWUpLmZpcnN0KCk7XG5cbiAgICAgICAgICAgIGVsWzBdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxbMF0pO1xuXG4gICAgICAgICAgICB0aGlzLmRyYWdFbC5yZW1vdmUoKTsgLy9SZW1vdmUgZHJhZ0VsLCBjYXVzZSBpdCBjYW4gYWZmZWN0IG9uIGluZGV4aW5nIGluIGh0bWwgY29sbGVjdGlvbi5cblxuICAgICAgICAgICAgLy9CZWZvcmUgZHJhZyBzdG9wIGNhbGxiYWNrXG4gICAgICAgICAgICB2YXIgY29udGludWVFeGVjdXRpb24gPSB0aGlzLm9wdGlvbnMuYmVmb3JlRHJhZ1N0b3AuY2FsbCh0aGlzLCB0aGlzLmVsLCBlbCwgdGhpcy5wbGFjZUVsLnBhcmVudCgpKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29udGludWVFeGVjdXRpb24gIT09ICd1bmRlZmluZWQnICYmIGNvbnRpbnVlRXhlY3V0aW9uID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLnBsYWNlRWwucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGFjZUVsLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIGlmICghcGFyZW50LmNoaWxkcmVuKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5zZXRQYXJlbnQocGFyZW50LnBhcmVudCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5yZXN0b3JlSXRlbUF0SW5kZXgoZWwsIHNyY0luZGV4KTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnBsYWNlRWwucmVwbGFjZVdpdGgoZWwpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5oYXNOZXdSb290KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5maXhlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3RvcmVJdGVtQXRJbmRleChlbCwgc3JjSW5kZXgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbC50cmlnZ2VyKCdsb3N0SXRlbScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdSb290RWwudHJpZ2dlcignZ2FpbmVkSXRlbScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnUm9vdEVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuY2FsbGJhY2suY2FsbCh0aGlzLCB0aGlzLmRyYWdSb290RWwsIGVsLCBwb3NpdGlvbik7XG5cbiAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkcmFnTW92ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyIGxpc3QsIHBhcmVudCwgcHJldiwgbmV4dCwgZGVwdGgsXG4gICAgICAgICAgICAgICAgb3B0ID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIG1vdXNlID0gdGhpcy5tb3VzZTtcblxuICAgICAgICAgICAgdGhpcy5kcmFnRWwuY3NzKHtcbiAgICAgICAgICAgICAgICAnbGVmdCc6IGUucGFnZVggLSBtb3VzZS5vZmZzZXRYLFxuICAgICAgICAgICAgICAgICd0b3AnOiBlLnBhZ2VZIC0gbW91c2Uub2Zmc2V0WVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIG1vdXNlIHBvc2l0aW9uIGxhc3QgZXZlbnRzXG4gICAgICAgICAgICBtb3VzZS5sYXN0WCA9IG1vdXNlLm5vd1g7XG4gICAgICAgICAgICBtb3VzZS5sYXN0WSA9IG1vdXNlLm5vd1k7XG4gICAgICAgICAgICAvLyBtb3VzZSBwb3NpdGlvbiB0aGlzIGV2ZW50c1xuICAgICAgICAgICAgbW91c2Uubm93WCA9IGUucGFnZVg7XG4gICAgICAgICAgICBtb3VzZS5ub3dZID0gZS5wYWdlWTtcbiAgICAgICAgICAgIC8vIGRpc3RhbmNlIG1vdXNlIG1vdmVkIGJldHdlZW4gZXZlbnRzXG4gICAgICAgICAgICBtb3VzZS5kaXN0WCA9IG1vdXNlLm5vd1ggLSBtb3VzZS5sYXN0WDtcbiAgICAgICAgICAgIG1vdXNlLmRpc3RZID0gbW91c2Uubm93WSAtIG1vdXNlLmxhc3RZO1xuICAgICAgICAgICAgLy8gZGlyZWN0aW9uIG1vdXNlIHdhcyBtb3ZpbmdcbiAgICAgICAgICAgIG1vdXNlLmxhc3REaXJYID0gbW91c2UuZGlyWDtcbiAgICAgICAgICAgIG1vdXNlLmxhc3REaXJZID0gbW91c2UuZGlyWTtcbiAgICAgICAgICAgIC8vIGRpcmVjdGlvbiBtb3VzZSBpcyBub3cgbW92aW5nIChvbiBib3RoIGF4aXMpXG4gICAgICAgICAgICBtb3VzZS5kaXJYID0gbW91c2UuZGlzdFggPT09IDAgPyAwIDogbW91c2UuZGlzdFggPiAwID8gMSA6IC0xO1xuICAgICAgICAgICAgbW91c2UuZGlyWSA9IG1vdXNlLmRpc3RZID09PSAwID8gMCA6IG1vdXNlLmRpc3RZID4gMCA/IDEgOiAtMTtcbiAgICAgICAgICAgIC8vIGF4aXMgbW91c2UgaXMgbm93IG1vdmluZyBvblxuICAgICAgICAgICAgdmFyIG5ld0F4ID0gTWF0aC5hYnMobW91c2UuZGlzdFgpID4gTWF0aC5hYnMobW91c2UuZGlzdFkpID8gMSA6IDA7XG5cbiAgICAgICAgICAgIC8vIGRvIG5vdGhpbmcgb24gZmlyc3QgbW92ZVxuICAgICAgICAgICAgaWYgKCFtb3VzZS5tb3ZpbmcpIHtcbiAgICAgICAgICAgICAgICBtb3VzZS5kaXJBeCA9IG5ld0F4O1xuICAgICAgICAgICAgICAgIG1vdXNlLm1vdmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBkbyBzY3JvbGxpbmcgaWYgZW5hYmxlXG4gICAgICAgICAgICBpZiAob3B0LnNjcm9sbCkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93LmpRdWVyeS5mbi5zY3JvbGxQYXJlbnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsUGFyZW50ID0gdGhpcy5lbC5zY3JvbGxQYXJlbnQoKVswXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjcm9sbFBhcmVudCAhPT0gZG9jdW1lbnQgJiYgc2Nyb2xsUGFyZW50LnRhZ05hbWUgIT09ICdIVE1MJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChvcHQuc2Nyb2xsVHJpZ2dlcnMuYm90dG9tICsgc2Nyb2xsUGFyZW50Lm9mZnNldEhlaWdodCkgLSBlLnBhZ2VZIDwgb3B0LnNjcm9sbFNlbnNpdGl2aXR5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFBhcmVudC5zY3JvbGxUb3AgPSBzY3JvbGxlZCA9IHNjcm9sbFBhcmVudC5zY3JvbGxUb3AgKyBvcHQuc2Nyb2xsU3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlLnBhZ2VZIC0gb3B0LnNjcm9sbFRyaWdnZXJzLnRvcCA8IG9wdC5zY3JvbGxTZW5zaXRpdml0eSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxQYXJlbnQuc2Nyb2xsVG9wID0gc2Nyb2xsZWQgPSBzY3JvbGxQYXJlbnQuc2Nyb2xsVG9wIC0gb3B0LnNjcm9sbFNwZWVkO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG9wdC5zY3JvbGxUcmlnZ2Vycy5yaWdodCArIHNjcm9sbFBhcmVudC5vZmZzZXRXaWR0aCkgLSBlLnBhZ2VYIDwgb3B0LnNjcm9sbFNlbnNpdGl2aXR5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0ID0gc2Nyb2xsZWQgPSBzY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCArIG9wdC5zY3JvbGxTcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGUucGFnZVggLSBvcHQuc2Nyb2xsVHJpZ2dlcnMubGVmdCA8IG9wdC5zY3JvbGxTZW5zaXRpdml0eSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCA9IHNjcm9sbGVkID0gc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQgLSBvcHQuc2Nyb2xsU3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5wYWdlWSAtICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpIDwgb3B0LnNjcm9sbFNlbnNpdGl2aXR5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGVkID0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpIC0gb3B0LnNjcm9sbFNwZWVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCQod2luZG93KS5oZWlnaHQoKSAtIChlLnBhZ2VZIC0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkpIDwgb3B0LnNjcm9sbFNlbnNpdGl2aXR5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGVkID0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpICsgb3B0LnNjcm9sbFNwZWVkKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucGFnZVggLSAkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkgPCBvcHQuc2Nyb2xsU2Vuc2l0aXZpdHkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsZWQgPSAkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSAtIG9wdC5zY3JvbGxTcGVlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgkKHdpbmRvdykud2lkdGgoKSAtIChlLnBhZ2VYIC0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKSA8IG9wdC5zY3JvbGxTZW5zaXRpdml0eSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpICsgb3B0LnNjcm9sbFNwZWVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignVG8gdXNlIHNjcm9sbGluZyB5b3UgbmVlZCB0byBoYXZlIHNjcm9sbFBhcmVudCgpIGZ1bmN0aW9uLCBjaGVjayBkb2N1bWVudGF0aW9uIGZvciBtb3JlIGluZm9ybWF0aW9uJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxUaW1lcikge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNjcm9sbFRpbWVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG9wdC5zY3JvbGwgJiYgc2Nyb2xsZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoZSk7XG4gICAgICAgICAgICAgICAgfSwgMTApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjYWxjIGRpc3RhbmNlIG1vdmVkIG9uIHRoaXMgYXhpcyAoYW5kIGRpcmVjdGlvbilcbiAgICAgICAgICAgIGlmIChtb3VzZS5kaXJBeCAhPT0gbmV3QXgpIHtcbiAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhYID0gMDtcbiAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhZID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vdXNlLmRpc3RBeFggKz0gTWF0aC5hYnMobW91c2UuZGlzdFgpO1xuICAgICAgICAgICAgICAgIGlmIChtb3VzZS5kaXJYICE9PSAwICYmIG1vdXNlLmRpclggIT09IG1vdXNlLmxhc3REaXJYKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vdXNlLmRpc3RBeFggPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhZICs9IE1hdGguYWJzKG1vdXNlLmRpc3RZKTtcbiAgICAgICAgICAgICAgICBpZiAobW91c2UuZGlyWSAhPT0gMCAmJiBtb3VzZS5kaXJZICE9PSBtb3VzZS5sYXN0RGlyWSkge1xuICAgICAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhZID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb3VzZS5kaXJBeCA9IG5ld0F4O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIG1vdmUgaG9yaXpvbnRhbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBpZiAobW91c2UuZGlyQXggJiYgbW91c2UuZGlzdEF4WCA+PSBvcHQudGhyZXNob2xkKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVzZXQgbW92ZSBkaXN0YW5jZSBvbiB4LWF4aXMgZm9yIG5ldyBwaGFzZVxuICAgICAgICAgICAgICAgIG1vdXNlLmRpc3RBeFggPSAwO1xuICAgICAgICAgICAgICAgIHByZXYgPSB0aGlzLnBsYWNlRWwucHJldihvcHQuaXRlbU5vZGVOYW1lKTtcbiAgICAgICAgICAgICAgICAvLyBpbmNyZWFzZSBob3Jpem9udGFsIGxldmVsIGlmIHByZXZpb3VzIHNpYmxpbmcgZXhpc3RzLCBpcyBub3QgY29sbGFwc2VkLCBhbmQgY2FuIGhhdmUgY2hpbGRyZW5cbiAgICAgICAgICAgICAgICBpZiAobW91c2UuZGlzdFggPiAwICYmIHByZXYubGVuZ3RoICYmICFwcmV2Lmhhc0NsYXNzKG9wdC5jb2xsYXBzZWRDbGFzcykgJiYgIXByZXYuaGFzQ2xhc3Mob3B0Lm5vQ2hpbGRyZW5DbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2Fubm90IGluY3JlYXNlIGxldmVsIHdoZW4gaXRlbSBhYm92ZSBpcyBjb2xsYXBzZWRcbiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IHByZXYuZmluZChvcHQubGlzdE5vZGVOYW1lKS5sYXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIGRlcHRoIGxpbWl0IGhhcyByZWFjaGVkXG4gICAgICAgICAgICAgICAgICAgIGRlcHRoID0gdGhpcy5wbGFjZUVsLnBhcmVudHMob3B0Lmxpc3ROb2RlTmFtZSkubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGVwdGggKyB0aGlzLmRyYWdEZXB0aCA8PSBvcHQubWF4RGVwdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgc3ViLWxldmVsIGlmIG9uZSBkb2Vzbid0IGV4aXN0XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVTdWJMZXZlbChwcmV2LCB0aGlzLnBsYWNlRWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWxzZSBhcHBlbmQgdG8gbmV4dCBsZXZlbCB1cFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QgPSBwcmV2LmNoaWxkcmVuKG9wdC5saXN0Tm9kZU5hbWUpLmxhc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmFwcGVuZCh0aGlzLnBsYWNlRWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGRlY3JlYXNlIGhvcml6b250YWwgbGV2ZWxcbiAgICAgICAgICAgICAgICBpZiAobW91c2UuZGlzdFggPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIGNhbid0IGRlY3JlYXNlIGEgbGV2ZWwgaWYgYW4gaXRlbSBwcmVjZWVkcyB0aGUgY3VycmVudCBvbmVcbiAgICAgICAgICAgICAgICAgICAgbmV4dCA9IHRoaXMucGxhY2VFbC5uZXh0KG9wdC5pdGVtTm9kZU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5leHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSB0aGlzLnBsYWNlRWwucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlRWwuY2xvc2VzdChvcHQuaXRlbU5vZGVOYW1lKS5hZnRlcih0aGlzLnBsYWNlRWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJlbnQuY2hpbGRyZW4oKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc2V0UGFyZW50KHBhcmVudC5wYXJlbnQoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpc0VtcHR5ID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIGZpbmQgbGlzdCBpdGVtIHVuZGVyIGN1cnNvclxuICAgICAgICAgICAgaWYgKCFoYXNQb2ludGVyRXZlbnRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnRWxbMF0uc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5wb2ludEVsID0gJChkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGUucGFnZVggLSBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQsIGUucGFnZVkgLSAod2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3ApKSk7XG4gICAgICAgICAgICBpZiAoIWhhc1BvaW50ZXJFdmVudHMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdFbFswXS5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMucG9pbnRFbC5oYXNDbGFzcyhvcHQuaGFuZGxlQ2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wb2ludEVsID0gdGhpcy5wb2ludEVsLmNsb3Nlc3Qob3B0Lml0ZW1Ob2RlTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5wb2ludEVsLmhhc0NsYXNzKG9wdC5lbXB0eUNsYXNzKSkge1xuICAgICAgICAgICAgICAgIGlzRW1wdHkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIXRoaXMucG9pbnRFbC5sZW5ndGggfHwgIXRoaXMucG9pbnRFbC5oYXNDbGFzcyhvcHQuaXRlbUNsYXNzKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZmluZCBwYXJlbnQgbGlzdCBvZiBpdGVtIHVuZGVyIGN1cnNvclxuICAgICAgICAgICAgdmFyIHBvaW50RWxSb290ID0gdGhpcy5wb2ludEVsLmNsb3Nlc3QoJy4nICsgb3B0LnJvb3RDbGFzcyksXG4gICAgICAgICAgICAgICAgaXNOZXdSb290ID0gdGhpcy5kcmFnUm9vdEVsLmRhdGEoJ25lc3RhYmxlLWlkJykgIT09IHBvaW50RWxSb290LmRhdGEoJ25lc3RhYmxlLWlkJyk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogbW92ZSB2ZXJ0aWNhbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBpZiAoIW1vdXNlLmRpckF4IHx8IGlzTmV3Um9vdCB8fCBpc0VtcHR5KSB7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgZ3JvdXBzIG1hdGNoIGlmIGRyYWdnaW5nIG92ZXIgbmV3IHJvb3RcbiAgICAgICAgICAgICAgICBpZiAoaXNOZXdSb290ICYmIG9wdC5ncm91cCAhPT0gcG9pbnRFbFJvb3QuZGF0YSgnbmVzdGFibGUtZ3JvdXAnKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gZml4ZWQgaXRlbSdzIGRlcHRoLCB1c2UgZm9yIHNvbWUgbGlzdCBoYXMgc3BlY2lmaWMgdHlwZSwgZWc6J1ZvbHVtZSwgU2VjdGlvbiwgQ2hhcHRlciAuLi4nXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5maXhlZERlcHRoICYmIHRoaXMuZHJhZ0RlcHRoICsgMSAhPT0gdGhpcy5wb2ludEVsLnBhcmVudHMob3B0Lmxpc3ROb2RlTmFtZSkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBjaGVjayBkZXB0aCBsaW1pdFxuICAgICAgICAgICAgICAgIGRlcHRoID0gdGhpcy5kcmFnRGVwdGggLSAxICsgdGhpcy5wb2ludEVsLnBhcmVudHMob3B0Lmxpc3ROb2RlTmFtZSkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmIChkZXB0aCA+IG9wdC5tYXhEZXB0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBiZWZvcmUgPSBlLnBhZ2VZIDwgKHRoaXMucG9pbnRFbC5vZmZzZXQoKS50b3AgKyB0aGlzLnBvaW50RWwuaGVpZ2h0KCkgLyAyKTtcbiAgICAgICAgICAgICAgICBwYXJlbnQgPSB0aGlzLnBsYWNlRWwucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgLy8gaWYgZW1wdHkgY3JlYXRlIG5ldyBsaXN0IHRvIHJlcGxhY2UgZW1wdHkgcGxhY2Vob2xkZXJcbiAgICAgICAgICAgICAgICBpZiAoaXNFbXB0eSkge1xuICAgICAgICAgICAgICAgICAgICBsaXN0ID0gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KG9wdC5saXN0Tm9kZU5hbWUpKS5hZGRDbGFzcyhvcHQubGlzdENsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5hcHBlbmQodGhpcy5wbGFjZUVsKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb2ludEVsLnJlcGxhY2VXaXRoKGxpc3QpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChiZWZvcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb2ludEVsLmJlZm9yZSh0aGlzLnBsYWNlRWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb2ludEVsLmFmdGVyKHRoaXMucGxhY2VFbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghcGFyZW50LmNoaWxkcmVuKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5zZXRQYXJlbnQocGFyZW50LnBhcmVudCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmRyYWdSb290RWwuZmluZChvcHQuaXRlbU5vZGVOYW1lKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRFbXB0eUVsZW1lbnQodGhpcy5kcmFnUm9vdEVsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gcGFyZW50IHJvb3QgbGlzdCBoYXMgY2hhbmdlZFxuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ1Jvb3RFbCA9IHBvaW50RWxSb290O1xuICAgICAgICAgICAgICAgIGlmIChpc05ld1Jvb3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNOZXdSb290ID0gdGhpcy5lbFswXSAhPT0gdGhpcy5kcmFnUm9vdEVsWzBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvLyBBcHBlbmQgdGhlIC5kZC1lbXB0eSBkaXYgdG8gdGhlIGxpc3Qgc28gaXQgY2FuIGJlIHBvcHVsYXRlZCBhbmQgc3R5bGVkXG4gICAgICAgIGFwcGVuZEVtcHR5RWxlbWVudDogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQoJzxkaXYgY2xhc3M9XCInICsgdGhpcy5vcHRpb25zLmVtcHR5Q2xhc3MgKyAnXCIvPicpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICQuZm4ubmVzdGFibGUgPSBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgICAgdmFyIGxpc3RzICA9IHRoaXMsXG4gICAgICAgICAgICByZXR2YWwgPSB0aGlzLFxuICAgICAgICAgICAgYXJncyAgID0gYXJndW1lbnRzO1xuXG4gICAgICAgIGlmICghKCdOZXN0YWJsZScgaW4gd2luZG93KSkge1xuICAgICAgICAgICAgd2luZG93Lk5lc3RhYmxlID0ge307XG4gICAgICAgICAgICBOZXN0YWJsZS5jb3VudGVyID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxpc3RzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgcGx1Z2luID0gJCh0aGlzKS5kYXRhKFwibmVzdGFibGVcIik7XG5cbiAgICAgICAgICAgIGlmICghcGx1Z2luKSB7XG4gICAgICAgICAgICAgICAgTmVzdGFibGUuY291bnRlcisrO1xuICAgICAgICAgICAgICAgICQodGhpcykuZGF0YShcIm5lc3RhYmxlXCIsIG5ldyBQbHVnaW4odGhpcywgcGFyYW1zKSk7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5kYXRhKFwibmVzdGFibGUtaWRcIiwgTmVzdGFibGUuY291bnRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBhcmFtcyA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIHBsdWdpbltwYXJhbXNdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBsdWdpbkFyZ3MgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsdWdpbkFyZ3MucHVzaChhcmdzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHZhbCA9IHBsdWdpbltwYXJhbXNdLmFwcGx5KHBsdWdpbiwgcGx1Z2luQXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR2YWwgPSBwbHVnaW5bcGFyYW1zXSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcmV0dmFsIHx8IGxpc3RzO1xuICAgIH07XG5cbn0pKHdpbmRvdy5qUXVlcnkgfHwgd2luZG93LlplcHRvLCB3aW5kb3csIGRvY3VtZW50KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/nestable2/jquery.nestable.js\n");

/***/ }),

/***/ 9:
/*!**************************************************************!*\
  !*** multi ./Modules/Menu/Resources/assets/admin/js/main.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(/*! /Users/nnhshu/workspace/sithimy/Modules/Menu/Resources/assets/admin/js/main.js */"./Modules/Menu/Resources/assets/admin/js/main.js");


/***/ })

/******/ });